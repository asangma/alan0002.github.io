<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Graphicsster</title>

    <link href="../../esri/css/view.css" rel="stylesheet" type="text/css">

    <style>
      html, body {
        margin:0;
        padding:0;
        height: 100%;
      }
      body {
        font-family: source-sans-pro, sans-serif;
        position: relative;
        overflow: hidden;
      }
      body.dark {
        color: #F0F1F1;
        background: #4A4D4E;
      }
      #map {
        width: 100%;
        height: 100%;
      }
      .panel {
        z-index: 1;
        position: fixed;
        background: -webkit-linear-gradient(#555555, #000000);
        background: -moz-linear-gradient(#555555, #000000);
        opacity: 0.8;
        padding: 5px;
      }
      .panel > .title {
        position: relative;
        float: left;
        left: 10px;
        top: 6px;
      }
      .panel > .right {
        position: relative;
        float: right;
        right: 10px;
        top: 6px;
      }
      .panel a {
        color: #FF6622;
      }
    </style>

    <script src="./jsapi.js"></script>
    <script src="../../dojo/dojo.js"></script>

    <script type="text/javascript">
      var map, view, graphicsLayer;

      jsAPI.setup([
        "dojo/_base/lang",
        "dojo/_base/array",
        "dojo/_base/Color",

        "esri/Map",
        "esri/views/SceneView",

        "esri/geometry/SpatialReference",

        "esri/layers/GraphicsLayer",
        "esri/renderers/SimpleRenderer",
        "esri/symbols/SimpleLineSymbol",

        "esri/tasks/QueryTask",
        "esri/tasks/support/Query"
      ], function(
        lang, array, Color,
        Map, SceneView,
        SpatialReference,
        GraphicsLayer, SimpleRenderer, SimpleLineSymbol, QueryTask, Query
      ) {
        // setup the map
        map = new Map({
          basemap: "topo"
        });

        view = new SceneView({
          container: "map",
          map: map
        });

        var symbol = new SimpleLineSymbol({
          width: 10
        });

        var renderer = new SimpleRenderer(symbol);

        renderer.setColorInfo({
          field: "M086_07",
          minDataValue: 0,
          maxDataValue: 10,
          colors: [
            new Color([255, 0, 0]),
            new Color([0, 0, 255])
          ]
        });

        graphicsLayer = new GraphicsLayer({
          renderer: renderer
        });

        map.add(graphicsLayer);

        var task = new QueryTask("http://services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/USA_County_Crops_2007/FeatureServer/0");
        var query = new Query({
          where: "FID<20",
          returnGeometry: true,
          maxAllowableOffset: 0.05,
          outFields: ["M086_07"],
          outSpatialReference: new SpatialReference(102100)
        });

        task.execute(query).then(function(result) {
          array.forEach(result.features, function(feature) {
            graphicsLayer.add(feature);
          });

          view.animateTo(result.features);
        });
      });

    </script>
  </head>

  <body class="dark">
    <div id="map"></div>
    <div class="panel" style="position:fixed; width:100%; height:35px; top:0px;">
      <span class="title">Graphicsster</span>ent()
      <div class="right">

      </div>
    </div>
  </body>

</html>
