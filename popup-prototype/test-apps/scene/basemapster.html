<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Map</title>

    <link href="../../dijit/themes/claro/claro.css" rel="stylesheet" type="text/css">
    <link href="../../esri/css/main.css" rel="stylesheet" type="text/css">

    <style type="text/css">
      .esriMapRoot {
        position: relative;
        height:100%;
      }
      .esriMapViewport {
        height:100%;
      }

      input {
        width:7em;
      }
    </style>

    <script src="./jsapi.js"></script>
    <script src="../../dojo/dojo.js"></script>

    <script>
      var map, view;

      jsAPI.setup([
        "dojo/on", "dojo/dom",
        "esri/Map", "esri/views/MapView", "esri/views/SceneView"
      ], function (
        on, dom,
        Map, MapView, SceneView) {

        map = new Map({
          basemap: "streets"
        });

        view = new SceneView({
          container: "mapDiv",
          map: map//,
          // center: [ -56.049, 38.485 ],
          // zoom: 3
        });

        on(dom.byId("getExtent"), "click", function() {
          var extent = view.get("extent");

          dom.byId("xmin").value = extent.xmin;
          dom.byId("xmax").value = extent.xmax;
          dom.byId("ymin").value = extent.ymin;
          dom.byId("ymax").value = extent.ymax;

          try {
            require(
              {packages: [{"name": "prototypeUtils", "location": "../../../../../js-prototype-apps/utils"},
                          {"name": "engine", "location": "../../../../../js-webgl-engine"}]},
              ["prototypeUtils/ExtentVisualizer"],
              function(ExtentVisualizer) {
                if (!window.extentVisualizer) {
                  window.extentVisualizer = new ExtentVisualizer(view);
                }

                window.extentVisualizer.update(extent);
              }
            );
          } catch(e) {
            console.warn("unable to display extent: " + e.message);
          }
        });

        on(dom.byId("basemap"), "change", function(e){
          map.set("basemap", e.srcElement.options[e.srcElement.selectedIndex].value);
        });

        on(dom.byId("getCenter"), "click", function() {
          var center = view.get("center");

          dom.byId("lon").value = center.get("longitude");
          dom.byId("lat").value = center.get("latitude");
        });

        on(dom.byId("setCenter"), "click", function() {
          view.animateTo([parseFloat(dom.byId("lon").value), parseFloat(dom.byId("lat").value)]);
        });

        on(dom.byId("destroy"), "click", function(){
          view.destroy();
          map.destroy();

          map = null;
          view = null;
        });

        on(dom.byId("create"), "click", function(){
          var type = dom.byId("viewportType").options[dom.byId("viewportType").selectedIndex].value;

          var types = {
            "2d": MapView,
            "3d": SceneView
          };

          var ViewClass = types[type];

          if (view) {
            try {
              view.destroy();
            } catch (err) { console.log(err); }

            view = null;
          }

          if (map) {
            try {
              map.destroy();
            } catch (err) { console.log(err); }

            map = null;
          }

          map = new Map({
            basemap: "streets"//,
              // center:  [ -56.049, 38.485 ],
              // zoom:    3
          });

          view = new ViewClass({
            container: "mapDiv",
            map: map
          });
        });
      });
    </script>
  </head>

  <body class="claro">

  <div id="mapDiv" style="width: 900px; height: 600px; border: 1px solid #000;"></div>
  <div id="mapControl" style="border: 1px solid #000;">
    <div>Basemap:
    <select id="basemap">
    <option value = "satellite">World_Imagery</option>
    <option value = "streets">streets</option>
    <option value = "topo">topt</option>
    <option value = "osm">osm</option>
    <option value = "gray">gray</option>
    <option value = "national-geographic">NatGeo</option>
    <option value = "oceans">oceans</option>
    </select>
    </div>

    <div>
      lat: <input id="ymin" type="text"/> <input id="ymax" type="text"/>
      lon: <input id="xmin" type="text"/> <input id="xmax" type="text"/>
      <input id="getExtent" type="button" value="getExtent"/><input id="setExtent" type="button" value="setExtent"/>
    </div>

    <div>lat:<input type="text" id="lat"/> lon:<input type="text" id="lon"/><input id="getCenter" type="button" value="getCenter"/><input id="setCenter" type="button" value="setCenter"/></div>


    <div>
      <input type="button" value="destroy" id="destroy"><br>
      <input type="button" value="create" id="create">
      <select id="viewportType">
      <option value="2d">2d</option>
      <option value="3d">3d</option>
      </select>
    </div>
  </div>
  </body>
</html>
