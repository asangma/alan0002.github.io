<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Dynamicster</title>

    <link href="../../esri/css/view.css" rel="stylesheet" type="text/css">

    <script src="./jsapi.js"></script>
    <script src="../../dojo/dojo.js"></script>

    <script>
      var map, view;

      jsAPI.setup(function() {
        var dynLayers = {
          "weirdBorders": "http://75.101.133.103/ArcGIS/rest/services/agolAOI_v3/MapServer",
          "worldCities":"http://sampleserver5.arcgisonline.com/arcgis/rest/services/SampleWorldCities/MapServer",
          "military":"http://sampleserver6.arcgisonline.com/arcgis/rest/services/Military/MapServer",
          "population": "http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Population_World/MapServer"
        };


        var tiledLayers = {
          "Topo":      "http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",
          "Satellite": "http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",
          "Street":    "http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",
          "Oceans":    "http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer",
          "Gray":      "http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"
        };

        var extents = {
          "sanfrancisco":    {"xmin":-13642384.327822307,"ymin":4541704.0524831535,"xmax":-13619758.967449924,"ymax":4553303.371525413,"spatialReference":{"wkid":102100}},
          "allenfieldhouse": {"xmin":-10603861.177707408,"ymin":4714986.293707896,"xmax":-10603154.135195673,"ymax":4715269.946742587,"spatialReference":{"wkid":102100}},
          "technopark":      {"xmin":947695.5377291957,"ymin":6005684.184757532,"xmax":948402.5802409305,"ymax":6006046.663477653,"spatialReference":{"wkid":102100}}
        };

      window.createMap = function createMap(viewClassName) {
        if (view) {
          try {
            view.destroy();
          } catch (err) { console.error(err); }

          view = null;
        }

        if (map) {
          try {
            map.destroy();
          } catch (err) { console.error(err); }

          map = null;
        }

        require([
          "esri/Map",
          "esri/views/" + viewClassName
        ],
        function(
          Map, ViewClass
        ) {
          map = new Map({
            basemap: "topo"
          });

          view = new ViewClass({
            map: map,
            container: "mapDiv"
          });
        });
      };

      window.addLayer = function addLayer(id) {
        require(["esri/layers/ArcGISTiledLayer"], function(ArcGISTiledLayer) {
          var layer = new ArcGISTiledLayer(tiledLayers[id], { id: id });
          map.add(layer);
        });
      };

      window.removeLayer = function removeLayer(id) {
        map.remove(map.getLayer(id));
      };

      window.addDynamicLayer = function addDynamicLayer(idOrUrl) {
          require(["esri/layers/ArcGISDynamicLayer"], function(ArcGISDynamicLayer) {
          var layer;

          if (dynLayers[idOrUrl]) {
            layer = new ArcGISDynamicLayer(dynLayers[idOrUrl], {name:idOrUrl});
          }
          else {
            layer = new ArcGISDynamicLayer(idOrUrl);
          }

          map.add(layer);
        });
      };

      window.removeDynamicLayer = function removeDynamicLayer(id) {
        var layer = map.layers.find(function(l) { return l.name === id; });
        map.remove(layer);
      };

      window.setExtent = function setExtent(name) {
        require(["esri/geometry/Extent"], function(Extent) {
          view.set("extent", new Extent(extents[name]));
        });
      };
    });
    </script>
  </head>

  <body>
    <p>
      Create Map:
      <input type="button" value="2D" onclick="createMap('MapView');" />
      <input type="button" value="3D" onclick="createMap('SceneView');" />
      <br/>

      Add Tiled Layer:
      <input type="button" value="Topo" onclick="addLayer('Topo');" />
      <input type="button" value="Satellite" onclick="addLayer('Satellite');" />
      <input type="button" value="Street" onclick="addLayer('Street');" />
      <input type="button" value="Oceans" onclick="addLayer('Oceans');" />
      <input type="button" value="Gray" onclick="addLayer('Gray');" />
      <br/>

      Remove Tiled Layer:
      <input type="button" value="Topo" onclick="removeLayer('Topo');" />
      <input type="button" value="Satellite" onclick="removeLayer('Satellite');" />
      <input type="button" value="Street" onclick="removeLayer('Street');" />
      <input type="button" value="Oceans" onclick="removeLayer('Oceans');" />
      <input type="button" value="Gray" onclick="removeLayer('Gray');" />
      <br/>


      Add Dynamic Map Layer:
          <input type="button" value="weirdBorders" onclick="addDynamicLayer('weirdBorders');" />
      <input type="button" value="worldCities" onclick="addDynamicLayer('worldCities');" />
      <input type="button" value="military" onclick="addDynamicLayer('military');" />
      <input type="button" value="population" onclick="addDynamicLayer('population');" />


      <br/>

      Remove Dynamic Map Layer:
      <input type="button" value="weirdBorders" onclick="removeDynamicLayer('weirdBorders');" />
      <input type="button" value="worldCities" onclick="removeDynamicLayer('worldCities');" />
      <input type="button" value="military" onclick="removeDynamicLayer('military');" />
      <input type="button" value="population" onclick="removeDynamicLayer('population');" />
      <br/>

    <!--
      //new Canvas3DDynamicLayerView("http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer");
      //new Canvas3DDynamicLayerView("http://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer");
      //new Canvas3DDynamicLayerView("http://10.112.20.127:6080/arcgis/rest/services/police_districts/MapServer");
    -->



      Set Extent:
      <input type="button" value="San Francisco" onclick="setExtent('sanfrancisco');" />
      <input type="button" value="Allen Fieldhouse" onclick="setExtent('allenfieldhouse');" />
      <input type="button" value="Technopark" onclick="setExtent('technopark');" />
    </p>

    <div id="mapDiv" style="width: 800px; height: 600px; border: 1px solid #000;"></div>

  </body>
</html>
