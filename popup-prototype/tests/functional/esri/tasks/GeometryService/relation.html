
<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>IdentifyTask</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">

  <link rel="stylesheet" href="../../../../../esri/css/main.css">

  <script>
    var dojoConfig = {
      async: true,
      isDebug: true,

      paths: {
        esri: "../esri"
      }
    };
  </script>

  <style>
    html, body {
      padding: 0;
      margin: 0;
    }
  </style>


  <script type="text/javascript" src="../../../../../dojo/dojo.js"></script>
  <script>
    var map, view, identifyParams;

    require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/GraphicsLayer",

        "esri/Graphic",
        "esri/geometry/Point",
        "esri/geometry/Polyline",
        "esri/geometry/Polygon",

        "esri/symbols/SimpleMarkerSymbol",
        "esri/symbols/SimpleLineSymbol",
        "esri/symbols/SimpleFillSymbol",

        "esri/geometry/SpatialReference",

        'esri/tasks/GeometryService',
        "esri/tasks/support/RelationParameters",

        "dojo/domReady!"
      ],
      function(
        Map, MapView, GraphicsLayer,
        Graphic, Point, Polyline, Polygon,
        SimpleMarkerSymbol, SimpleLineSymbol, SimpleFillSymbol,
        SpatialReference,
        GeometryService, RelationParameters
      ) {

        map = new Map({
          basemap: "topo"
        });

        view = new MapView({
          container: "viewDiv",
          map: map,
          center: [-145.19682693481445, 40.06020952545651],
          zoom: 6
        });

        view.then(
          function() {
            var graphicsLayer = new GraphicsLayer();
            map.add(graphicsLayer);

            var polygon1 = new Polygon([
              [-140.20061978149414, 37.06001021532272],
              [-145.19682693481445, 44.06020952545651],
              [-140.20082693482441, 40.05828952743655],
              [-140.20061978149414, 37.06001021532272]
            ], new SpatialReference({wkid:4326}));

            var fillSymbol = new SimpleFillSymbol({
              color: "red"
            });

            var polygonGraphic1 = new Graphic({
              geometry: polygon1,
              symbol: fillSymbol
            });

            graphicsLayer.add(polygonGraphic1);



            var markerSymbol = new SimpleMarkerSymbol({
              color: "blue",
              size: 10
            });

            var point1 = new Point([
              -141.86609121699996, 40.39283642200007
            ], new SpatialReference({wkid:4326}));

            var pointGraphic1 = new Graphic({
              geometry: point1,
              symbol: markerSymbol
            });

            var point2 = new Point([
              -146.86609121699996, 40.39283642200007
            ], new SpatialReference({wkid:4326}));

            var pointGraphic2 = new Graphic({
              geometry: point2,
              symbol: markerSymbol
            });

            var point3 = new Point([
              -140.86609121699996, 40.39283642200007
            ], new SpatialReference({wkid:4326}));

            var pointGraphic3 = new Graphic({
              geometry: point3,
              symbol: markerSymbol
            });

            var point4 = new Point([
              -142.86609121699996, 40.39283642200007
            ], new SpatialReference({wkid:4326}));

            var pointGraphic4 = new Graphic({
              geometry: point4,
              symbol: markerSymbol
            });

            var point5 = new Point([
              -145.86609121699996, 40.39283642200007
            ], new SpatialReference({wkid:4326}));

            var pointGraphic5 = new Graphic({
              geometry: point5,
              symbol: markerSymbol
            });

            graphicsLayer.add(pointGraphic1);
            graphicsLayer.add(pointGraphic2);
            graphicsLayer.add(pointGraphic3);
            graphicsLayer.add(pointGraphic4);
            graphicsLayer.add(pointGraphic5);



            var params = new RelationParameters();

            params.geometries1 = [point1,point2,point3,point4,point5];
            params.geometries2 = [polygon1];
            params.relation = "esriGeometryRelationWithin";


            var geometryService = new GeometryService("http://sampleserver6.arcgisonline.com/arcgis/rest/services/Utilities/Geometry/GeometryServer");
            geometryService.relation(params).then(
              function(result) {
                console.log(result);
              }
            );



            var polyline1 = new Polyline([
              [-145.20061978149414, 37.06001021532272],
              [-140.19682693481445, 44.06020952545651],
              [-145.20082693482441, 40.05828952743655]
            ], new SpatialReference({wkid:4326}));

            var lineSymbol = new SimpleLineSymbol({
              color: "blue",
              width: 4
            });

            var polylineGraphic1 = new Graphic({
              geometry: polyline1,
              symbol: lineSymbol
            });

            graphicsLayer.add(polylineGraphic1);

            var polyline2 = new Polyline([
              [-141.20061978149414, 37.06001021532272],
              [-146.19682693481445, 44.06020952545651]
            ], new SpatialReference({wkid:4326}));

            var lineSymbol = new SimpleLineSymbol({
              color: "red",
              width: 4
            });

            var polylineGraphic2 = new Graphic({
              geometry: polyline2,
              symbol: lineSymbol
            });

            graphicsLayer.add(polylineGraphic2);

            var polyline3 = new Polyline([
              [-135.20061978149414, 46.06001021532272],
              [-145.19682693481445, 44.06020952545651],
              [-140.20082693482441, 40.05828952743655]
            ], new SpatialReference({wkid:4326}));

            var lineSymbol = new SimpleLineSymbol({
              color: "orange",
              width: 4
            });

            var polylineGraphic3 = new Graphic({
              geometry: polyline3,
              symbol: lineSymbol
            });

            graphicsLayer.add(polylineGraphic3);

            params.geometries1 = [polyline3, polyline1];
            params.geometries2 = [polyline2];
            params.relation = "esriGeometryRelationCross";



            geometryService.relation(params).then(
              function(result) {
                console.log("esriGeometryRelationCross", result);
              }
            );

            var polygon2 = new Polygon([
              [-141.86609121699996, 40.39283642200007],
              [-140.86609121699996, 40.39283642200007],
              [-141.20082693482441, 40.05828952743655],
              [-141.86609121699996, 40.39283642200007],
            ], new SpatialReference({wkid:4326}));

            var fillSymbol = new SimpleFillSymbol({
              color: "green",

              outline: new SimpleLineSymbol({
                color: [255, 255, 255],
                width: 1
              })
            });

            var polygonGraphic2 = new Graphic({
              geometry: polygon2,
              symbol: fillSymbol
            });

            graphicsLayer.add(polygonGraphic2);

            var polygon3 = new Polygon([
              [-140.20061978149414, 37.06001021532272],
              [-145.19682693481445, 44.06020952545651],
              [-146.20082693482441, 40.05828952743655]
            ], new SpatialReference({wkid:4326}));

            var fillSymbol = new SimpleFillSymbol({
              color: "yellow",

              outline: new SimpleLineSymbol({
                color: [255, 255, 255],
                width: 1
              })
            });

            var polygonGraphic3 = new Graphic({
              geometry: polygon3,
              symbol: fillSymbol
            });

            graphicsLayer.add(polygonGraphic3);


            params.geometries1 = [polygon2];
            params.geometries2 = [polygon1, polygon3];
            params.relation = "esriGeometryRelationIn";



            geometryService.relation(params).then(
              function(result) {
                console.log("esriGeometryRelationIn", result);
              }
            );

            params.geometries1 = [polygon2, polygon3];
            params.geometries2 = [polygon1];
            params.relation = "esriGeometryRelationInteriorIntersection";



            geometryService.relation(params).then(
              function(result) {
                console.log("esriGeometryRelationInteriorIntersectionr",result);
              }
            );

            params.geometries1 = [polygon2, polygon3];
            params.geometries2 = [polygon1];
            params.relation = "esriGeometryRelationIntersection";



            geometryService.relation(params).then(
              function(result) {
                console.log("esriGeometryRelationIntersection",result);
              }
            );

            params.geometries1 = [polyline2, polyline3];
            params.geometries2 = [polygon1];
            params.relation = "esriGeometryRelationLineCoincidence";



            geometryService.relation(params).then(
              function(result) {
                console.log("esriGeometryRelationLineCoincidence",result);
              },
              function (err) {
                console.log("esriGeometryRelationLineCoincidence",err);
              }
            );

            params.geometries1 = [polygon2, polygon3];
            params.geometries2 = [polygon1];
            params.relation = "esriGeometryRelationLineTouch";



            geometryService.relation(params).then(
              function(result) {
                console.log("esriGeometryRelationLineTouch",result);
              }
            );

            var polygon4 = new Polygon([
              [-145.20061978149414, 37.06001021532272],
              [-140.19682693481445, 44.06020952545651],
              [-145.20082693482441, 40.05828952743655]
            ], new SpatialReference({wkid:4326}));

            var fillSymbol = new SimpleFillSymbol({
              color: "violet",

              outline: new SimpleLineSymbol({
                color: [255, 255, 255],
                width: 1
              })
            });

            var polygonGraphic4 = new Graphic({
              geometry: polygon4,
              symbol: fillSymbol
            });

            graphicsLayer.add(polygonGraphic4);

            params.geometries1 = [polygon2, polygon4];
            params.geometries2 = [polygon1,polygon3];
            params.relation = "esriGeometryRelationOverlap";



            geometryService.relation(params).then(
              function(result) {
                console.log("esriGeometryRelationOverlap",result);
              }
            );


            var polygon5 = new Polygon([
              [-145.20061978149414, 37.06001021532272],
              [-130.19682693481445, 44.06020952545651],
              [-135.20082693482441, 40.05828952743655]
            ], new SpatialReference({wkid:4326}));

            var fillSymbol = new SimpleFillSymbol({
              color: "blue",

              outline: new SimpleLineSymbol({
                color: [255, 255, 255],
                width: 1
              })
            });

            var polygonGraphic5 = new Graphic({
              geometry: polygon5,
              symbol: fillSymbol
            });

            graphicsLayer.add(polygonGraphic5);

            params.geometries1 = [polygon2, polygon4];
            params.geometries2 = [polygon1,polygon3, polygon5];
            params.relation = "esriGeometryRelationPointTouch";



            geometryService.relation(params).then(
              function(result) {
                console.log("esriGeometryRelationPointTouch",result);
              }
            );

            params.geometries1 = [polygon2, polygon4];
            params.geometries2 = [polygon1,polygon3, polygon5];
            params.relation = "esriGeometryRelationTouch";


            var polyline4 = new Polyline([
              [-144.15682693481445, 43.06020952545651],
              [-141.00082693482441, 39.00828952743655]
            ], new SpatialReference({wkid:4326}));

            var lineSymbol = new SimpleLineSymbol({
              color: "yellow",
              width: 4
            });

            var polylineGraphic4 = new Graphic({
              geometry: polyline4,
              symbol: lineSymbol
            });

            graphicsLayer.add(polylineGraphic4);

            geometryService.relation(params).then(
              function(result) {
                console.log("esriGeometryRelationTouch",result);
              }
            );

            /*

             http://sampleserver6.arcgisonline.com/arcgis/rest/services/Utilities/Geometry/GeometryServer/relation?sr=4326&geometries1=%7B%22geometryType%22%3A%22esriGeometryPolygon%22%2C%22geometries%22%3A%5B%7B%22rings%22%3A%5B%5B%5B-141.86609121699996%2C40.39283642200007%5D%2C%5B-140.86609121699996%2C40.39283642200007%5D%2C%5B-141.20082693482442%2C40.05828952743655%5D%2C%5B-141.86609121699996%2C40.39283642200007%5D%5D%5D%2C%22spatialReference%22%3A%7B%22wkid%22%3A4326%7D%7D%2C%7B%22rings%22%3A%5B%5B%5B-140.20061978149414%2C37.06001021532272%5D%2C%5B-145.19682693481445%2C44.06020952545651%5D%2C%5B-140.20082693482442%2C40.05828952743655%5D%5D%5D%2C%22spatialReference%22%3A%7B%22wkid%22%3A4326%7D%7D%5D%7D&geometries2=%7B%22geometryType%22%3A%22esriGeometryPolyline%22%2C%22geometries%22%3A%5B%7B%22paths%22%3A%5B%5B%5B-144.15682693481446%2C43.06020952545651%5D%2C%5B-141.0008269348244%2C39.00828952743655%5D%5D%5D%2C%22spatialReference%22%3A%7B%22wkid%22%3A4326%7D%7D%5D%7D&relation=esriGeometryRelationRelation&relationParam=RELATE%28G1%2CG2%2C%27TTTFFTFFT%27%29&f=html
             */

            params.geometries1 = [polygon2, polygon1];
            params.geometries2 = [polyline4];
            params.relation = "esriGeometryRelationRelation";
            params.relationParam = "RELATE(G1,G2,'TTTFFTFFT')";
            console.log("esriGeometryRelationRelation",map.spatialReference);
            geometryService.relation(params).then(
              function(result) {
                console.log("esriGeometryRelationRelation",result);

              },
              function (err) {
                console.log("esriGeometryRelationRelation",err);
              }
            );

          }
        );


      });
  </script>
</head>

<body>
<div id="viewDiv"></div>
</body>

</html>
