
<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Geoprocessor Sync</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">

  <link rel="stylesheet" href="../../../../../../esri/css/main.css">

  <script>
    var dojoConfig = {
      async: true,
      isDebug: true,

      paths: {
        esri: "../esri"
      }
    };
  </script>

  <style>
    html, body {
      padding: 0;
      margin: 0;
    }
  </style>


  <script type="text/javascript" src="../../../../../../dojo/dojo.js"></script>
  <script>
    var map, view, identifyParams;

    require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/GraphicsLayer",

        "esri/Graphic",
        "esri/geometry/Polyline",
        "esri/geometry/Polygon",

        "esri/symbols/SimpleLineSymbol",
        "esri/symbols/SimpleFillSymbol",

        "esri/geometry/SpatialReference",

        'esri/tasks/Geoprocessor',
        "esri/tasks/support/FeatureSet",

        "dojo/domReady!"
      ],
      function(
        Map, MapView, GraphicsLayer,
        Graphic, Polyline, Polygon,
        SimpleLineSymbol, SimpleFillSymbol,
        SpatialReference,
        Geoprocessor, FeatureSet
      ) {

        map = new Map({
          basemap: "streets"
        });

        view = new MapView({
          container: "viewDiv",
          map: map,
          center: [-87.572, 33.329],
          zoom: 6
        });

        view.then(
          function() {
            var graphicsLayer = new GraphicsLayer();
            map.add(graphicsLayer);

            var polygon1 = new Polygon([
              [-87.572, 33.329],
              [-86.572, 34.329],
              [-85.572, 32.329],
              [-87.572, 33.329]
            ]);

            var fillSymbol = new SimpleFillSymbol({
              color: "red",

              outline: new SimpleLineSymbol({
                color: [255, 255, 255],
                width: 1
              })
            });

            var polygonGraphic1 = new Graphic({
              geometry: polygon1,
              symbol: fillSymbol
            });

            graphicsLayer.add(polygonGraphic1);

            var featureSet = new FeatureSet();
            featureSet.features = [polygonGraphic1];

            var params = { "inputPoly":featureSet };


            var geoprocessor = new Geoprocessor("http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Population_World/GPServer/PopulationSummary");
            geoprocessor.outSpatialReference = new SpatialReference({wkid: 102100});

            console.log("executing...");

            geoprocessor.execute(params).then(function(result){
              console.log("result...");
              console.log(result);
            }, function(err) {
              console.log(err);
            })
          }
        );


      });
  </script>
</head>

<body>
<div id="viewDiv"></div>
</body>

</html>
