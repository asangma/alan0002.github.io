
<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>IdentifyTask</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">

  <link rel="stylesheet" href="../../../../esri/css/main.css">

  <script>
    var dojoConfig = {
      async: true,
      isDebug: true,

      paths: {
        esri: "../esri"
      }
    };
  </script>

  <style>
    html, body {
      padding: 0;
      margin: 0;
    }
    #missionCtrl {
      position: absolute;
      top: 1em;
      right: 1em;
      background: #ffffff;
      padding: 1em;
    }
  </style>


  <script type="text/javascript" src="../../../../dojo/dojo.js"></script>
  <script>
    var map, view, identifyParams;

    require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/GraphicsLayer",

        "esri/Graphic",
        "esri/geometry/Point",
        "esri/geometry/Polyline",
        "esri/geometry/Polygon",

        "esri/symbols/SimpleMarkerSymbol",
        "esri/symbols/SimpleLineSymbol",
        "esri/symbols/SimpleFillSymbol",

        "esri/geometry/SpatialReference",

        'esri/tasks/RouteTask',
        "esri/tasks/support/RouteParameters",
        "esri/tasks/support/RouteResult",
        "esri/tasks/support/FeatureSet",

        "dojo/dom",
        "dojo/on",
        "dojo/domReady!"
      ],
      function(
        Map, MapView, GraphicsLayer,
        Graphic, Point, Polyline, Polygon,
        SimpleMarkerSymbol, SimpleLineSymbol, SimpleFillSymbol,
        SpatialReference,
        RouteTask, RouteParameters, RouteResult, FeatureSet,
        dom, on
      ) {

        map = new Map({
          basemap: "topo"
        });

        view = new MapView({
          container: "viewDiv",
          map: map,
          center: [-117.149593, 32.735677],
          zoom: 14
        });

        view.then(function(){

          var routeTask = new RouteTask("http://sampleserver6.arcgisonline.com/arcgis/rest/services/NetworkAnalysis/SanDiego/NAServer/Route");

          var graphicsLayer = new GraphicsLayer();
          map.add(graphicsLayer);

          var point1 = new Point(-117.149593, 32.735677, new SpatialReference({wkid: 4326}));
          var point2 = new Point(-117.159593, 32.735677, new SpatialReference({wkid: 4326}));

          var markerSymbol = new SimpleMarkerSymbol({
            color: [226, 119, 40],

            outline: new SimpleLineSymbol({
              color: [255, 255, 255],
              width: 2
            })
          });

          var pointGraphic1 = new Graphic({
            geometry: point1,
            symbol: markerSymbol
          });
          var pointGraphic2 = new Graphic({
            geometry: point2,
            symbol: markerSymbol
          });

          graphicsLayer.add(pointGraphic1);
          graphicsLayer.add(pointGraphic2);

          var params = new RouteParameters();

          params.stops = new FeatureSet();
          params.stops.features = [pointGraphic1, pointGraphic2];
          params.returnDirections = true;

          on(dom.byId("execute"), "click", execute);

          function execute(){

            params.directionsOutputType = dom.byId("type").value;
            console.log(params.directionsOutputType);
            routeTask.solve(params).then(function (result) {
              console.log(result);

              result.routeResults[0].directions.features.forEach(function (feature) {
                console.log(feature.attributes.text);
              });

              var geo = result.routeResults[0].directions.mergedGeometry;

              var g = new Graphic({
                geometry:geo,
                symbol: new SimpleLineSymbol({
                  width: 5,
                  color: "red"
                })
              });

              graphicsLayer.add(g);


            });
          };
        })


      });
  </script>
</head>

<body>
<div id="viewDiv"></div>
<div id="missionCtrl">
  <select name="type" id="type">
    <option value="complete">complete</option>
    <option value="complete-no-events">complete-no-events</option>
    <option value="instructions-only">instructions-only</option>
    <option value="standard">standard</option>
    <option value="summary-only">summary-only</option>
  </select>
  <button id="execute">execute</button>
  <p>see console for results..</p>
</div>
</body>

</html>
