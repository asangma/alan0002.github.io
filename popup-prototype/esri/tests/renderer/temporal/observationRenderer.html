<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>ApplyEdits</title>
        <link rel="stylesheet" type="text/css" href="../../../../dojo/dijit/themes/tundra/tundra.css">
        <script>
            dojoConfig = {
                isDebug: true
            };
        </script>
        <script type="text/javascript" src="../../../../../index.jsp">
        </script>

        <script type="text/javascript">
            dojo.require("esri.layers.FeatureLayer");
            dojo.require("esri.map");
            dojo.require("doh.runner");
            
            var featureLayer, graphics;
            function init(){
                console.log("init");
                
                var startExtent = new esri.geometry.Extent({
                    "xmin": -83.62,
                    "ymin": -42.53,
                    "xmax": -63.85,
                    "ymax": -29.35,
                    "spatialReference": {
                        "wkid": 4326
                    }
                });
                //create map
                var map = new esri.Map("mapDiv", {
                    extent: startExtent
                });
                featureLayer = new esri.layers.FeatureLayer("http://servicesbeta.esri.com/ArcGIS/rest/services/Earthquakes/Since_March_2010/MapServer/0", {
                    mode: esri.layers.FeatureLayer.MODE_SNAPSHOT,
                    outFields: ["*"]
                });
                
                var timeExtent = new esri.TimeExtent();
                timeExtent.startTime = new Date("Sat, 27 Feb 2010 06:00:00 UTC");
                timeExtent.endTime = new Date("Mon, 1 Mar 2010 06:00:00 UTC");
                ;
                
                featureLayer.setTimeDefinition(timeExtent);
                featureLayer.setDefinitionExpression("LATITUDE > -43 and LATITUDE < -29 and LONGITUDE > -84 and LONGITUDE < -63");
                
                
                var observationRenderer = new esri.renderer.ClassBreaksRenderer(new esri.symbol.SimpleMarkerSymbol(), "MAGNITUDE");
                observationRenderer.addBreak(7, 12, new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE, dojox.gfx.px2pt(35), new esri.symbol.SimpleLineSymbol().setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID).setColor(new dojo.Color([100, 100, 100])), new dojo.Color([0, 0, 0, 0])));
                observationRenderer.addBreak(6, 7, new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE, dojox.gfx.px2pt(30), new esri.symbol.SimpleLineSymbol().setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID).setColor(new dojo.Color([100, 100, 100])), new dojo.Color([0, 0, 0, 0])));
                observationRenderer.addBreak(5, 6, new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE, dojox.gfx.px2pt(25), new esri.symbol.SimpleLineSymbol().setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID).setColor(new dojo.Color([100, 100, 100])), new dojo.Color([0, 0, 0, 0])));
                observationRenderer.addBreak(4, 5, new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE, dojox.gfx.px2pt(20), new esri.symbol.SimpleLineSymbol().setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID).setColor(new dojo.Color([100, 100, 100])), new dojo.Color([0, 0, 0, 0])));
                observationRenderer.addBreak(3, 4, new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE, dojox.gfx.px2pt(15), new esri.symbol.SimpleLineSymbol().setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID).setColor(new dojo.Color([100, 100, 100])), new dojo.Color([0, 0, 0, 0])));
                observationRenderer.addBreak(2, 3, new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE, dojox.gfx.px2pt(10), new esri.symbol.SimpleLineSymbol().setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID).setColor(new dojo.Color([100, 100, 100])), new dojo.Color([0, 0, 0, 0])));
                observationRenderer.addBreak(0, 2, new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE, dojox.gfx.px2pt(5), new esri.symbol.SimpleLineSymbol().setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID).setColor(new dojo.Color([100, 100, 100])), new dojo.Color([0, 0, 0, 0])));
                
                var infos = [{
                    minAge: 0,
                    maxAge: 1,
                    color: new dojo.Color([255, 0, 0])
                }, {
                    minAge: 1,
                    maxAge: 24,
                    color: new dojo.Color([49, 154, 255])
                }, {
                    minAge: 24,
                    maxAge: Infinity,
                    color: new dojo.Color([255, 255, 8])
                }];
                
                var ager = new esri.renderer.TimeClassBreaksAger(infos, esri.renderer.TimeClassBreaksAger.UNIT_HOURS);
                var renderer = new esri.renderer.TemporalRenderer(observationRenderer, null, null, ager);
                featureLayer.setRenderer(renderer);
                
                dojo.connect(featureLayer, "onLoad", runTests);
                map.addLayer(featureLayer);
                
                
            }
            
            function runTests(){
                console.log("runtests");
                
                
                doh.registerGroup("tests.renderer.temporal.observationRenderer", [{
                    name: "observationRenderer",
                    timeout: 3000,
                    runTest: function(){
                    
                        var renderer = featureLayer.renderer;
                        doh.assertEqual("MAGNITUDE", renderer.observationRenderer.attributeField);
                        doh.assertEqual(7,renderer.observationRenderer.breaks.length);
						doh.assertEqual("simplemarkersymbol",renderer.observationRenderer.defaultSymbol.type);
                        
                    }
                    
                }, ]);
                doh.run();
            }
            
            dojo.addOnLoad(init);
        </script>
    </head>
    <body class="tundra">
        <div id="mapDiv" style="width:900px; height:600px; border:1px solid #000;">
        </div>
    </body>
</html>
