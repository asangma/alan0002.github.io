<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>onLoad</title>

    <link rel="stylesheet" type="text/css" href="../../../../dojo/dijit/themes/tundra/tundra.css">
    <script type="text/javascript" src="../../../../dojo/dojo/dojo.js" djConfig="isDebug:true"></script>
    <script type="text/javascript" src="../../../esri.js"></script>
    <script type="text/javascript" src="../../../jsapi.js"></script>

    <script type="text/javascript">
      dojo.require("esri.map");
      dojo.require("doh.runner");
	  
	  var map,basemap,graphicsLayer;
	  var attributes = {"NAME" : "Douglas",
        			"ObjectID" : 1242,
       				 "STATE_NAME" : "Kansas",
        			 "STATE_FIPS" : "20",
        			 "CNTY_FIPS" : "045",
        			 "FIPS" : "20045",
        			 "POP2000" : 99962,
        			"POP2007" : 107920,
        			"POP00_SQMI" : 210.7,
        			"POP07_SQMI" : 227.5,
        			"WHITE" : 86060,
        			"BLACK" : 4238,
        			"AMERI_ES" : 2561,
        			"ASIAN" : 3119,
        			"HAWN_PI" : 62,
        			"OTHER" : 1197,
        			"MULT_RACE" : 2725,
        			"HISPANIC" : 3268,
        			"MALES" : 49651,
       		 		"FEMALES" : 50311,
        			"AGE_UNDER5" : 5568,
        			"AGE_5_17" : 14833,
        			"AGE_18_21" : 17042,
        			"AGE_22_29" : 17915,
       				"AGE_30_39" : 13265,
        			"AGE_40_49" : 12596,
        			"AGE_50_64" : 10806,
        			"AGE_65_UP" : 7937,
        			"AGE_UNDER5P" : 5.6,
        			"AGE_5_17P" : 14.8,
        			"AGE_18_21P" : 17,
        			"AGE_22_29P" : 17,
        			"AGE_30_39P" : 13.3,
        			"AGE_40_49P" : 12.6,
        			"AGE_50_64P" : 10.8,
        			"AGE_65_UPP" : 7.9,
        			"MED_AGE" : 26.6,
        			"MED_AGE_M" : 26.1,
        			"MED_AGE_F" : 27.3,
        			"HOUSEHOLDS" : 38486,
        			"AVE_HH_SZ" : 2.37,
        			"HSEHLD_1_M" : 5185,
        			"HSEHLD_1_F" : 5795,
        			"MARHH_CHD" : 7673,
        			"MARHH_NO_C" : 8917,
        			"MHH_CHILD" : 701,
        			"FHH_CHILD" : 2170,
        			"FAMILIES" : 21159,
        			"AVE_FAM_SZ" : 2.97,
        			"HSE_UNITS" : 40250,
        			"VACANT" : 1764,
        			"OWNER_OCC" : 19975,
        			"RENTER_OCC" : 18511,
        			"NO_FARMS97" : 839,
        			"AVG_SIZE97" : 260,
        			"CROP_ACR97" : 146918,
        			"AVG_SALE97" : 46.35,
        			"SQMI" : 474.4,
        			"Shape_Length" : 1.53853402891229,
        			"Shape_Area" : 0.12913459051245
      };
	 
	  var expectedContents ="NAME = Douglas<br/>ObjectID = 1242<br/>STATE_NAME = Kansas<br/>STATE_FIPS = 20<br/>CNTY_FIPS = 045<br/>FIPS = 20045<br/>POP2000 = 99962<br/>POP2007 = 107920<br/>POP00_SQMI = 210.7<br/>POP07_SQMI = 227.5<br/>WHITE = 86060<br/>BLACK = 4238<br/>AMERI_ES = 2561<br/>ASIAN = 3119<br/>HAWN_PI = 62<br/>OTHER = 1197<br/>MULT_RACE = 2725<br/>HISPANIC = 3268<br/>MALES = 49651<br/>FEMALES = 50311<br/>AGE_UNDER5 = 5568<br/>AGE_5_17 = 14833<br/>AGE_18_21 = 17042<br/>AGE_22_29 = 17915<br/>AGE_30_39 = 13265<br/>AGE_40_49 = 12596<br/>AGE_50_64 = 10806<br/>AGE_65_UP = 7937<br/>AGE_UNDER5P = 5.6<br/>AGE_5_17P = 14.8<br/>AGE_18_21P = 17<br/>AGE_22_29P = 17<br/>AGE_30_39P = 13.3<br/>AGE_40_49P = 12.6<br/>AGE_50_64P = 10.8<br/>AGE_65_UPP = 7.9<br/>MED_AGE = 26.6<br/>MED_AGE_M = 26.1<br/>MED_AGE_F = 27.3<br/>HOUSEHOLDS = 38486<br/>AVE_HH_SZ = 2.37<br/>HSEHLD_1_M = 5185<br/>HSEHLD_1_F = 5795<br/>MARHH_CHD = 7673<br/>MARHH_NO_C = 8917<br/>MHH_CHILD = 701<br/>FHH_CHILD = 2170<br/>FAMILIES = 21159<br/>AVE_FAM_SZ = 2.97<br/>HSE_UNITS = 40250<br/>VACANT = 1764<br/>OWNER_OCC = 19975<br/>RENTER_OCC = 18511<br/>NO_FARMS97 = 839<br/>AVG_SIZE97 = 260<br/>CROP_ACR97 = 146918<br/>AVG_SALE97 = 46.35<br/>SQMI = 474.4<br/>Shape_Length = 1.53853402891229<br/>Shape_Area = 0.12913459051245<br/>";
       function init(){
	   	var extent = new esri.geometry.Extent(-116, -40, 59, 65, new esri.SpatialReference({
	   		wkid: 4326
	   	}));
	   	map = new esri.Map("map", {
	   		extent: extent
	   	});
	   	dojo.connect(map, "onLoad", runTests);
	   	
	   	basemap = new esri.layers.ArcGISTiledMapServiceLayer("http://server.arcgisonline.com/ArcGIS/rest/services/NGS_Topo_US_2D/MapServer");
	  	map.addLayer(basemap);
				
	   }
		
	   
				
      function runTests() {
        doh.registerGroup("graphic.point.set_method", [
          {
            name: "setAttributes",
            timeout: 3000,
            runTest: function(t) {
				
				dojo.connect(basemap,"onUpdate",addPointGraphic);
				
				var d = new doh.Deferred();			
			    function assert(graphic) {
                					
					t.assertEqual("Point Graphic Test", graphic.getTitle());
					t.assertEqual(expectedContents, graphic.getContent());
					t.assertEqual("circle", graphic.getDojoShape().shape.type);
			       	d.callback(true);
              	}
				
              	function addPointGraphic() {
	   				
					var point = new esri.geometry.Point(-100,40,map.spatialReference);
        			var pointSymbol = new esri.symbol.SimpleMarkerSymbol().setColor(new dojo.Color("red"));
        			var content = "${*}";
        			var infoTemplate = new esri.InfoTemplate("Point Graphic Test",content);
        			graphic = new esri.Graphic(null,null,null,null);
					graphic.setAttributes(attributes);
					graphic.setGeometry(point);
					graphic.setInfoTemplate(infoTemplate);
					graphic.setSymbol(pointSymbol);
									
					graphicsLayer = map.graphics;
        			dojo.connect(graphicsLayer,"onGraphicAdd",assert);
					graphicsLayer.add(graphic);
	
      		}
              return d; 
            }
			
          
          }
        ]);
		
        doh.run();
      }
     
      dojo.addOnLoad(init);
    </script>

  </head>
  <body class="tundra">
    <div id="map" style="width:1024px; height:512px; border:1px solid #000;"></div>
  </body>
</html>
