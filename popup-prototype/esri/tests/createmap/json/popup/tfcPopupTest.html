<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>visibleLayers</title>
        <link rel="stylesheet" type="text/css" href="../../../../../dojo/dijit/themes/tundra/tundra.css">
        <script>
            dojoConfig = {
                isDebug: true
            };
        </script>
        <script type="text/javascript" src="../../../../../../index.jsp">
        </script>
        <script type="text/javascript">
            dojo.require("esri.arcgis.utils");
            dojo.require("doh.runner");
            
            function init(){
                esri.arcgis.utils.arcgisUrl = "http://dev.arcgis.com/sharing/content/items";
                var webmap = {};
                webmap.item = {
                    "title": "TFC_Event_Map",
                    "extent": [[-128.43, 25.14], [-84.27, 48.38]],
                    "tags": ["TFC", "twolayer", "unit test"]
                };
                var itemDataJson = {
                    "operationalLayers": [{
                        "id": "mapNotes_8663",
                        "title": "Events",
                        "featureCollection": {
                            "showLegend": true,
                            "layers": [{
                                "popupInfo": {
                                    "title": "{TITLE}",
                                    "description": "{DESCRIPTION}",
                                    "mediaInfos": [{
                                        "type": "image",
                                        "value": {
                                            "sourceURL": "{IMAGE_URL}",
                                            "linkURL": "{IMAGE_LINK_URL}"
                                        }
                                    }]
                                },
                                "layerDefinition": {
                                    "name": "Events - Event Areas",
                                    "type": "Feature Layer",
                                    "displayField": "TITLE",
                                    "visibilityField": "VISIBLE",
                                    "geometryType": "esriGeometryPolygon",
                                    "drawingInfo": {
                                        "renderer": {
                                            "type": "uniqueValue",
                                            "field1": "TYPEID",
                                            "uniqueValueInfos": []
                                        }
                                    },
                                    "hasAttachments": false,
                                    "objectIdField": "OBJECTID",
                                    "typeIdField": "TYPEID",
                                    "fields": [{
                                        "name": "OBJECTID",
                                        "type": "esriFieldTypeOID",
                                        "alias": "OBJECTID",
                                        "editable": false
                                    }, {
                                        "name": "TITLE",
                                        "type": "esriFieldTypeString",
                                        "alias": "Title",
                                        "editable": true,
                                        "length": 50
                                    }, {
                                        "name": "VISIBLE",
                                        "type": "esriFieldTypeInteger",
                                        "alias": "Visible",
                                        "editable": true
                                    }, {
                                        "name": "DESCRIPTION",
                                        "type": "esriFieldTypeString",
                                        "alias": "Description",
                                        "editable": true,
                                        "length": 1073741822
                                    }, {
                                        "name": "IMAGE_URL",
                                        "type": "esriFieldTypeString",
                                        "alias": "Image URL",
                                        "editable": true,
                                        "length": 255
                                    }, {
                                        "name": "IMAGE_LINK_URL",
                                        "type": "esriFieldTypeString",
                                        "alias": "Image Link URL",
                                        "editable": true,
                                        "length": 255
                                    }, {
                                        "name": "DATE",
                                        "type": "esriFieldTypeDate",
                                        "alias": "DATE",
                                        "editable": true,
                                        "length": 36
                                    }, {
                                        "name": "TYPEID",
                                        "type": "esriFieldTypeInteger",
                                        "alias": "Type ID",
                                        "editable": true
                                    }],
                                    "types": [],
                                    "templates": [],
                                    "capabilities": "Query,Editing"
                                },
                                "featureSet": {
                                    "geometryType": "esriGeometryPolygon",
                                    "features": []
                                },
                                "nextObjectId": 0
                            }, {
                                "popupInfo": {
                                    "title": "{TITLE}",
                                    "description": "{DESCRIPTION}",
                                    "mediaInfos": [{
                                        "type": "image",
                                        "value": {
                                            "sourceURL": "{IMAGE_URL}",
                                            "linkURL": "{IMAGE_LINK_URL}"
                                        }
                                    }]
                                },
                                "layerDefinition": {
                                    "name": "Events - Lines",
                                    "type": "Feature Layer",
                                    "displayField": "TITLE",
                                    "visibilityField": "VISIBLE",
                                    "geometryType": "esriGeometryPolyline",
                                    "drawingInfo": {
                                        "renderer": {
                                            "type": "uniqueValue",
                                            "field1": "TYPEID",
                                            "uniqueValueInfos": []
                                        }
                                    },
                                    "hasAttachments": false,
                                    "objectIdField": "OBJECTID",
                                    "typeIdField": "TYPEID",
                                    "fields": [{
                                        "name": "OBJECTID",
                                        "type": "esriFieldTypeOID",
                                        "alias": "OBJECTID",
                                        "editable": false
                                    }, {
                                        "name": "TITLE",
                                        "type": "esriFieldTypeString",
                                        "alias": "Title",
                                        "editable": true,
                                        "length": 50
                                    }, {
                                        "name": "VISIBLE",
                                        "type": "esriFieldTypeInteger",
                                        "alias": "Visible",
                                        "editable": true
                                    }, {
                                        "name": "DESCRIPTION",
                                        "type": "esriFieldTypeString",
                                        "alias": "Description",
                                        "editable": true,
                                        "length": 1073741822
                                    }, {
                                        "name": "IMAGE_URL",
                                        "type": "esriFieldTypeString",
                                        "alias": "Image URL",
                                        "editable": true,
                                        "length": 255
                                    }, {
                                        "name": "IMAGE_LINK_URL",
                                        "type": "esriFieldTypeString",
                                        "alias": "Image Link URL",
                                        "editable": true,
                                        "length": 255
                                    }, {
                                        "name": "DATE",
                                        "type": "esriFieldTypeDate",
                                        "alias": "DATE",
                                        "editable": true,
                                        "length": 36
                                    }, {
                                        "name": "TYPEID",
                                        "type": "esriFieldTypeInteger",
                                        "alias": "Type ID",
                                        "editable": true
                                    }],
                                    "types": [],
                                    "templates": [],
                                    "capabilities": "Query,Editing"
                                },
                                "featureSet": {
                                    "geometryType": "esriGeometryPolyline",
                                    "features": []
                                },
                                "nextObjectId": 0
                            }, {
                                "popupInfo": {
                                    "title": "{TITLE}",
                                    "description": "{DESCRIPTION}",
                                    "mediaInfos": [{
                                        "type": "image",
                                        "value": {
                                            "sourceURL": "{IMAGE_URL}",
                                            "linkURL": "{IMAGE_LINK_URL}"
                                        }
                                    }]
                                },
                                "layerDefinition": {
                                    "name": "Events - Event Labels",
                                    "type": "Feature Layer",
                                    "displayField": "TITLE",
                                    "visibilityField": "VISIBLE",
                                    "geometryType": "esriGeometryPoint",
                                    "drawingInfo": {
                                        "renderer": {
                                            "type": "uniqueValue",
                                            "field1": "TYPEID",
                                            "uniqueValueInfos": []
                                        }
                                    },
                                    "hasAttachments": false,
                                    "objectIdField": "OBJECTID",
                                    "typeIdField": "TYPEID",
                                    "fields": [{
                                        "name": "OBJECTID",
                                        "type": "esriFieldTypeOID",
                                        "alias": "OBJECTID",
                                        "editable": false
                                    }, {
                                        "name": "TITLE",
                                        "type": "esriFieldTypeString",
                                        "alias": "Title",
                                        "editable": true,
                                        "length": 50
                                    }, {
                                        "name": "VISIBLE",
                                        "type": "esriFieldTypeInteger",
                                        "alias": "Visible",
                                        "editable": true
                                    }, {
                                        "name": "DESCRIPTION",
                                        "type": "esriFieldTypeString",
                                        "alias": "Description",
                                        "editable": true,
                                        "length": 1073741822
                                    }, {
                                        "name": "IMAGE_URL",
                                        "type": "esriFieldTypeString",
                                        "alias": "Image URL",
                                        "editable": true,
                                        "length": 255
                                    }, {
                                        "name": "IMAGE_LINK_URL",
                                        "type": "esriFieldTypeString",
                                        "alias": "Image Link URL",
                                        "editable": true,
                                        "length": 255
                                    }, {
                                        "name": "DATE",
                                        "type": "esriFieldTypeDate",
                                        "alias": "DATE",
                                        "editable": true,
                                        "length": 36
                                    }, {
                                        "name": "TYPEID",
                                        "type": "esriFieldTypeInteger",
                                        "alias": "Type ID",
                                        "editable": true
                                    }, {
                                        "name": "TEXT",
                                        "type": "esriFieldTypeString",
                                        "alias": "Text",
                                        "length": 255,
                                        "editable": true
                                    }],
                                    "types": [],
                                    "templates": [],
                                    "capabilities": "Query,Editing"
                                },
                                "featureSet": {
                                    "geometryType": "esriGeometryPoint",
                                    "features": []
                                },
                                "nextObjectId": 0
                            }, {
                                "popupInfo": {
                                    "title": "{TITLE}",
                                    "description": "{DESCRIPTION}",
                                    "mediaInfos": [{
                                        "type": "image",
                                        "value": {
                                            "sourceURL": "{IMAGE_URL}",
                                            "linkURL": "{IMAGE_LINK_URL}"
                                        }
                                    }]
                                },
                                "layerDefinition": {
                                    "name": "Events - Events",
                                    "type": "Feature Layer",
                                    "displayField": "TITLE",
                                    "visibilityField": "VISIBLE",
                                    "geometryType": "esriGeometryPoint",
                                    "drawingInfo": {
                                        "renderer": {
                                            "type": "uniqueValue",
                                            "field1": "TYPEID",
                                            "uniqueValueInfos": [{
                                                "value": "0",
                                                "label": "Art Festival",
                                                "description": "",
                                                "symbol": {
                                                    "type": "esriPMS",
                                                    "url": "http://static.arcgis.com/images/Symbols/PeoplePlaces/MovieTheater.png",
                                                    "contentType": "image/png",
                                                    "width": 24,
                                                    "height": 24
                                                }
                                            }, {
                                                "value": "1",
                                                "label": "Farmers Market",
                                                "symbol": {
                                                    "type": "esriPMS",
                                                    "url": "http://static.arcgis.com/images/Symbols/PeoplePlaces/School.png",
                                                    "contentType": "image/png",
                                                    "width": 24,
                                                    "height": 24
                                                }
                                            }, {
                                                "value": "2",
                                                "label": "Movie Night",
                                                "symbol": {
                                                    "type": "esriPMS",
                                                    "url": "http://static.arcgis.com/images/Symbols/PeoplePlaces/MovieTheater.png",
                                                    "contentType": "image/png",
                                                    "width": 24,
                                                    "height": 24
                                                }
                                            }, {
                                                "value": "3",
                                                "label": "Fair",
                                                "symbol": {
                                                    "type": "esriPMS",
                                                    "url": "http://static.arcgis.com/images/Symbols/PeoplePlaces/AmusementPark.png",
                                                    "contentType": "image/png",
                                                    "width": 24,
                                                    "height": 24
                                                }
                                            }, {
                                                "value": "4",
                                                "label": "Parade",
                                                "symbol": {
                                                    "type": "esriPMS",
                                                    "url": "http://static.arcgis.com/images/Symbols/PeoplePlaces/Crowd.png",
                                                    "contentType": "image/png",
                                                    "width": 24,
                                                    "height": 24
                                                }
                                            }, {
                                                "value": "5",
                                                "label": "Other",
                                                "symbol": {
                                                    "type": "esriPMS",
                                                    "url": "http://static.arcgis.com/images/Symbols/PeoplePlaces/Question.png",
                                                    "contentType": "image/png",
                                                    "width": 24,
                                                    "height": 24
                                                }
                                            }]
                                        }
                                    },
                                    "hasAttachments": false,
                                    "objectIdField": "OBJECTID",
                                    "typeIdField": "TYPEID",
                                    "fields": [{
                                        "name": "OBJECTID",
                                        "type": "esriFieldTypeOID",
                                        "alias": "OBJECTID",
                                        "editable": false
                                    }, {
                                        "name": "TITLE",
                                        "type": "esriFieldTypeString",
                                        "alias": "Title",
                                        "editable": true,
                                        "length": 50
                                    }, {
                                        "name": "VISIBLE",
                                        "type": "esriFieldTypeInteger",
                                        "alias": "Visible",
                                        "editable": true
                                    }, {
                                        "name": "DESCRIPTION",
                                        "type": "esriFieldTypeString",
                                        "alias": "Description",
                                        "editable": true,
                                        "length": 1073741822
                                    }, {
                                        "name": "IMAGE_URL",
                                        "type": "esriFieldTypeString",
                                        "alias": "Image URL",
                                        "editable": true,
                                        "length": 255
                                    }, {
                                        "name": "IMAGE_LINK_URL",
                                        "type": "esriFieldTypeString",
                                        "alias": "Image Link URL",
                                        "editable": true,
                                        "length": 255
                                    }, {
                                        "name": "DATE",
                                        "type": "esriFieldTypeDate",
                                        "alias": "DATE",
                                        "editable": true,
                                        "length": 36
                                    }, {
                                        "name": "TYPEID",
                                        "type": "esriFieldTypeInteger",
                                        "alias": "Type ID",
                                        "editable": true
                                    }],
                                    "types": [{
                                        "id": 0,
                                        "name": "Art Festival",
                                        "domains": {},
                                        "templates": [{
                                            "name": "Art Festival",
                                            "description": "",
                                            "drawingTool": "esriFeatureEditToolPoint",
                                            "prototype": {
                                                "attributes": {
                                                    "TYPEID": 0,
                                                    "VISIBLE": 1,
                                                    "TITLE": "Art Festival"
                                                }
                                            }
                                        }]
                                    }, {
                                        "id": 1,
                                        "name": "Farmers Market",
                                        "domains": {},
                                        "templates": [{
                                            "name": "Farmers Market",
                                            "description": "",
                                            "drawingTool": "esriFeatureEditToolPoint",
                                            "prototype": {
                                                "attributes": {
                                                    "TYPEID": 1,
                                                    "VISIBLE": 1,
                                                    "TITLE": "Farmers Market"
                                                }
                                            }
                                        }]
                                    }, {
                                        "id": 2,
                                        "name": "Movie Night",
                                        "domains": {},
                                        "templates": [{
                                            "name": "Movie Night",
                                            "description": "",
                                            "drawingTool": "esriFeatureEditToolPoint",
                                            "prototype": {
                                                "attributes": {
                                                    "TYPEID": 2,
                                                    "VISIBLE": 1,
                                                    "TITLE": "Movie Night"
                                                }
                                            }
                                        }]
                                    }, {
                                        "id": 3,
                                        "name": "Fair",
                                        "domains": {},
                                        "templates": [{
                                            "name": "Fair",
                                            "description": "",
                                            "drawingTool": "esriFeatureEditToolPoint",
                                            "prototype": {
                                                "attributes": {
                                                    "TYPEID": 3,
                                                    "VISIBLE": 1,
                                                    "TITLE": "Fair"
                                                }
                                            }
                                        }]
                                    }, {
                                        "id": 4,
                                        "name": "Parade",
                                        "domains": {},
                                        "templates": [{
                                            "name": "Parade",
                                            "description": "",
                                            "drawingTool": "esriFeatureEditToolPoint",
                                            "prototype": {
                                                "attributes": {
                                                    "TYPEID": 4,
                                                    "VISIBLE": 1,
                                                    "TITLE": "Parade"
                                                }
                                            }
                                        }]
                                    }, {
                                        "id": 5,
                                        "name": "Other",
                                        "domains": {},
                                        "templates": [{
                                            "name": "Other",
                                            "description": "",
                                            "drawingTool": "esriFeatureEditToolPoint",
                                            "prototype": {
                                                "attributes": {
                                                    "TYPEID": 5,
                                                    "VISIBLE": 1,
                                                    "TITLE": "Other"
                                                }
                                            }
                                        }]
                                    }],
                                    "templates": [],
                                    "capabilities": "Query,Editing"
                                },
                                "featureSet": {
                                    "geometryType": "esriGeometryPoint",
                                    "features": [{
                                        "geometry": {
                                            "x": -1.2794952597933117E7,
                                            "y": 4326019.8989182515,
                                            "spatialReference": {
                                                "wkid": 102100
                                            }
                                        },
                                        "attributes": {
                                            "TYPEID": 2,
                                            "VISIBLE": 1,
                                            "TITLE": "Movie Night",
                                            "DATE": 1302547614537,
                                            "OBJECTID": 0,
                                            "IMAGE_URL": "http://jsmatrix:8080/10/winter.jpg",
                                            "DESCRIPTION": "International Movie night<br />"
                                        }
                                    }, {
                                        "geometry": {
                                            "x": -1.3054226997876365E7,
                                            "y": 3871066.7065650034,
                                            "spatialReference": {
                                                "wkid": 102100
                                            }
                                        },
                                        "attributes": {
                                            "TYPEID": 0,
                                            "VISIBLE": 1,
                                            "TITLE": "Art Festival",
                                            "DATE": 1302547650793,
                                            "OBJECTID": 1,
                                            "IMAGE_URL": "http://jsmatrix:8080/10/art.jpg",
                                            "DESCRIPTION": "Art Lunch on weekend<br />"
                                        },
                                        "symbol": {
                                            "angle": 0,
                                            "xoffset": 0,
                                            "yoffset": 0,
                                            "type": "esriPMS",
                                            "url": "http://static.arcgis.com/images/Symbols/Basic/esriCrimeMarker_86.png",
                                            "imageData": "iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAAYagMeiWXwAAAAlwSFlzAAAOwwAADsMBx2+oZAAAABl0RVh0U29mdHdhcmUAUGFpbnQuTkVUIHYzLjUuNUmK/OAAAAakSURBVHhe5ZstVFRbFMf/a71gMBgIBsMEAsEw4QUCwWAwEAgEg4FgMBAmGAwEgsFAIBAIBAKBYCAYDAaCwUAgGAiECQSDgUAgGPT8ZnF543D33udc7sxD56zL8uOevc/++O+Pc+5BGvOYk+Z6Um9dWt+Wtg+lQ376Uv+n9JOfU+m0+v8taYu5q9JqR0rPHzgWpUUUQbFKyaZ/nkgnm9LmEyk9d3h0pe6+tH8pXTZVNqI7l853pd07hQyEQfFI+Dbf/5B+gLCHUnr+p8HiCIEwbSpXwutCungrvX0gpWeCY0VaGSfUS4zAXELjmZSeCQwSUqmAk5gPEqkcYzMBMPsofWyqTFXqKIWUOX6WpKVlabn69460czhSIkvXg/8/UnpaHLPSLOWoRBg88kH6gFegLxWn6h+aGB0jtpYXEIQYy1WeuWvS2n0pPe0MlCHZkfRy5cBhtzbCjDST28zg8Q1pA5p21L7Jpao8uUb4JH1qHA4QAqWcxT5Lnx9J6ZnMIKSOpKMc2SjVjaQiIeUssJs6s3tSeiY7CLH30vscGYurQy9tXiLGYy87mfZ8I73JkfWplJ6MAbyi7o73pY0HfPEEWX201FUlkqrxSnrVKdwFUk4jI5Ccs5IikI6Y5UKK0ABNpSWU9b9KXzFGhs8GU6g8kdzrqfdw+XXTji5iQm6IhCKBIvyZdBbxi95jPDwcrcn7KCdQRt0N1IF04AlEto8SHjBjXqRY6XuQGZU0EuOxdOzx3kytfK0xI++z+YlKHU1Tbt9QagDmY9gojqMchh61OSaCD02OB8PSjrGJAaAhJKJmKyrhN8IY6Hjb2yiD4pVczzMPGJKQFtPRGfHN32lY+kPnhJ6BDlOD5oUDce7p8136/hs9gngLUmst78OIljPyKOXvXyk9/liQFlAw4hcl43fSO4/HvJSeq7GdtpDWZDKnl/h6QdMEejBwpPjo++fS82jzA3osvqDS62cw0DWtV65oTrxFvknfLOMB6cdSepoNEOPxp1fwQsGrRsepWgykQkAPKl4zQux6yCExNlP9PyqM4MXzSjqes9YgdD3dBlXttfTam9Rx2lLPO01gbynyQnphyXiUdoUWXTdo7F5KL6ltGxZzSo7FHM9YdF7YwA9UkejIxhiRJOp5EhoPzmR9S07PSWt00HvSnqUIvUETeFnZHjR9kb5Y62EUS5mnaTdn0Xlh6lUoSq8oTxZjqoNlALxcR2ehhmTlKV/xQuBSb+6nDzMWDe8s/QZ0ZFJrwgAixrDofisvQ7S9jDOGSg4rHHBInayEhyWnF+IDOi9GPGhZdBYN8PaS7fC7g7Qpq1PIyupervIqwYDOaxaW05m9ZVmLzqI5LzhZ7qf+oW5dsnadEUmmlpwWDXwGdFNvgKkPgalPgl6dnIoy6NXJqWiEmrbC82k//Ve0wlO/GfI2NXjYa4bW/4btMA2EVwqjAxGvwaGhGeeByGk6X2x6IEL1u26edpwPoRd3+EjM20I/KDkSo331+nT6aavVvJc+f+Xs8th1WtvkYd4LmYeiINPzPpsyTyfWuV73fjoW91piYI5FLSM8SkdLXhgNCwJsN295LA58kdmS52FwLI4+N4yHhzyLUS698z0sejnGW6KVbGxgOsHXYy+k4cP7G7o8SXdxPQOgHJ72jADEz1r4IGrJgedngwtXvPfQzDuTR4QCDhCIec8IM+mOEPNy9/658+hKPdgjE++Pg4+jtd6vFOq2+Hm8l06AgGuugtY8EMWe3jN69Q4jRSgmP7i8DoJP5CywmnkjE4/QLDUJC3oIqk+EuEqZtYwLElEeG/DKQQFx9Kzwbu7j9AGGtpswOzR+YYLSBnLmCj+oLLV5RQYj4LUIuhghFwk58G06xzvzG9YBIxWtEcVTxXz3D7gmh0OLlM/NqJURyPpRiSwWwCGgjB1lXpTEkY3XRqncTE5IkGQog40XDAjJ4Fvpa04UntV7SmJUOkNZFwo7vPM7clkax7WGSoyQi4TK+iCCrE6ijLq3Oi9QCagIUXNWh4acjjH0/OgErJkbd3VCnV79biAHrSQlfsjM7ESrf9OljZbIXLhX8zDYrWFvWQfGudWhVPA25m9adwCL3R0Q5NbeNpTK4UG4rTg3RdrWf8CPGL0LaCCkWkt2TSzVTd0zyS7HU23O2UsXOzqFt8qb6JdNM5++E4AI4NimosO8LtL5JIqX7hWylWhjIrs3sjvQ7Gfe/PQMdnL1y9Olm682dGmFR7ULpNRhFMrcaKmrSiT/T6fH3Kb9Q6nQvwBLLaWWGN67LAAAAABJRU5ErkJggg==",
                                            "contentType": "image/png",
                                            "width": 24,
                                            "height": 24
                                        }
                                    }, {
                                        "geometry": {
                                            "x": -1.3171634273322364E7,
                                            "y": 4047177.6197340023,
                                            "spatialReference": {
                                                "wkid": 102100
                                            }
                                        },
                                        "attributes": {
                                            "TYPEID": 4,
                                            "VISIBLE": 1,
                                            "TITLE": "Parade",
                                            "DATE": 1302547687948,
                                            "OBJECTID": 2,
                                            "DESCRIPTION": "Parade in LA<br />"
                                        }
                                    }]
                                },
                                "nextObjectId": 3
                            }]
                        },
                        "visibility": true,
                        "opacity": 1
                    }],
                    "baseMap": {
                        "baseMapLayers": [{
                            "id": "World_Street_Map_551",
                            "opacity": 1,
                            "visibility": true,
                            "url": "http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"
                        }],
                        "title": "Streets"
                    },
                    "widgets": {
                        "editor": {}
                    },
                    "version": "1.2"
                };
                
                webmap.itemData = itemDataJson;
                
                var mapDeferred = esri.arcgis.utils.createMap(webmap, "map", {
                    mapOptions: {
                        slider: true,
                        nav: false
                    }
                });
                mapDeferred.addCallback(function(response){
                    var map = response.map;
                    if (map.loaded) {
                        runTests(response);
                    }
                    else {
                        dojo.connect(map, "onLoad", function(){
                            runTests(response);
                        });
                        
                    }
                });
                mapDeferred.addErrback(function(error){
                    console.log("Map creation failed: ", dojo.toJson(error));
                });
            }
            
            function runTests(response){
                doh.registerGroup("createmap.json.popup.tfcPopupTest", [{
                    name: "layerTest",
                    timeout: 6000,
                    runTest: function(t){
                    
                        var map = response.map;
                        
                        var graphicsLayerIds = map.graphicsLayerIds;
                        var graphicLayer0 = map.getLayer(graphicsLayerIds[0]);
                        var graphicLayer1 = map.getLayer(graphicsLayerIds[1]);
                        var graphicLayer2 = map.getLayer(graphicsLayerIds[2]);
                        var graphicLayer3 = map.getLayer(graphicsLayerIds[3]);
                      				
						var infoTemplate0 = graphicLayer0.infoTemplate;
						
						t.assertEqual(infoTemplate0.info.title,"{TITLE}");
						t.assertEqual(infoTemplate0.info.description,"{DESCRIPTION}");
						//t.assertEqual(infoTemplate0.info.fieldInfos.length,0); no fieldInfos
						var mediaInfos0 = infoTemplate0.info.mediaInfos;
						t.assertEqual(mediaInfos0.length,1);
						t.assertEqual(mediaInfos0[0].type,"image");
						t.assertEqual(mediaInfos0[0].value.linkURL,"{IMAGE_LINK_URL}");
						t.assertEqual(mediaInfos0[0].value.sourceURL,"{IMAGE_URL}");
												
						var infoTemplate1 = graphicLayer1.infoTemplate;
						t.assertEqual(infoTemplate1.info.title,"{TITLE}");
						t.assertEqual(infoTemplate1.info.description,"{DESCRIPTION}");
						
						var mediaInfos1 = infoTemplate1.info.mediaInfos;
						t.assertEqual(mediaInfos1.length,1);
						t.assertEqual(mediaInfos1[0].type,"image");
						t.assertEqual(mediaInfos1[0].value.linkURL,"{IMAGE_LINK_URL}");
						t.assertEqual(mediaInfos1[0].value.sourceURL,"{IMAGE_URL}");
												
						var infoTemplate2 = graphicLayer2.infoTemplate;
						
						t.assertEqual(infoTemplate2.info.title,"{TITLE}");
						t.assertEqual(infoTemplate2.info.description,"{DESCRIPTION}");
						
						var mediaInfos2 = infoTemplate2.info.mediaInfos;
						t.assertEqual(mediaInfos2.length,1);
						t.assertEqual(mediaInfos2[0].type,"image");
						t.assertEqual(mediaInfos2[0].value.linkURL,"{IMAGE_LINK_URL}");
						t.assertEqual(mediaInfos2[0].value.sourceURL,"{IMAGE_URL}");
						
						var infoTemplate3 = graphicLayer3.infoTemplate;
						
						t.assertEqual(infoTemplate3.info.title,"{TITLE}");
						t.assertEqual(infoTemplate3.info.description,"{DESCRIPTION}");
						
						var mediaInfos3 = infoTemplate3.info.mediaInfos;
						t.assertEqual(mediaInfos3.length,1);
						t.assertEqual(mediaInfos3[0].type,"image");
						t.assertEqual(mediaInfos3[0].value.linkURL,"{IMAGE_LINK_URL}");
						t.assertEqual(mediaInfos3[0].value.sourceURL,"{IMAGE_URL}");
						
                       
                        
                        
                    }
                    
                    
                }]);
                doh.run();
            }
            
            dojo.addOnLoad(init);
        </script>
    </head>
    <body class="tundra">
        <div id="map" style="width:800px; height:600px; border:1px solid #000;">
        </div>
    </body>
</html>
