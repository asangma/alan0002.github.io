<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <title>Geoenrichment API</title>

    <style>
        html, body, .app, .map
        {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
        }

        .ProgressBar
        {
            position: fixed;
            left: 10px;
            bottom: 10px;
            width: 100px;
            display: none;
        }
    </style>
</head>
<body class="claro">
    <script src="inject.js"></script>
    <script src="config.js"></script>

    <script>
        require(["dojo/parser", "dijit/layout/BorderContainer", "dijit/layout/ContentPane", "dijit/form/Select", "dijit/ProgressBar"]);

        require([
            "dojo/ready",
            "esri/map",
            "esri/layers/FeatureLayer",
            "esri/renderers/SimpleRenderer",
            "esri/symbols/SimpleFillSymbol",
            "esri/Graphic",
            "esri/widgets/geoenrichment/Infographic",
            "esri/tasks/geoenrichment/GeometryStudyArea",
            "esri/IdentityManager"
        ], function (
            ready,
            Map,
            FeatureLayer,
            SimpleRenderer,
            SimpleFillSymbol,
            Graphic,
            Infographic,
            GeometryStudyArea,
            id
            ) {

            ready(function () {

                var map = new Map("map", {
                    basemap: "streets",
                    center: [-98.215, 38.382],
                    zoom: 7,
                    sliderStyle: "small"
                });
                var layer = new FeatureLayer("http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Census_USA/MapServer/3");
                layer.setRenderer(new SimpleRenderer(new SimpleFillSymbol()));
                map.addLayer(layer);

                var graphic;
                map.on("click", function (e) {
                    if (!e.graphic) {
                        return;
                    }
                    var geom = e.graphic.geometry;
                    if (!graphic) {
                        var symbol = new SimpleFillSymbol();
                        symbol.outline.width = 4;
                        graphic = new Graphic(geom, symbol);
                        map.graphics.add(graphic);
                    } else {
                        graphic.setGeometry(geom);
                    }

                    dijit.byId("infographic").set("studyArea", new GeometryStudyArea({ geometry: geom }));
                });

                selectInfographic();
            });
        });

        function showProgress() {
            dojo.byId("progressBar").style.display = "block";
        }

        function hideProgress() {
            dojo.byId("progressBar").style.display = "none";
        }

        var variables = {
            "AgePyramid": ["Age.*"],
            "Tapestry": ["Tapestry.*"],
            "RelatedVariables": ["RaceAndEthnicity.*"],
            "OneVar": ["KeyGlobalFacts.AVGHHSZ"]
        };
        function selectInfographic() {
            var infographic = dijit.byId("infographic");
            var type = dijit.byId("typeSelect").get("value");
            var expanded = dijit.byId("expandedSelect").get("value") == "true";
            infographic.set("type", type);
            infographic.set("variables", variables[type]);
            infographic.set("expanded", expanded);
        }

    </script>
    <div data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design:'sidebar'" style="width: 100%; height: 100%">
        <div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'leading',splitter:true" style="width: 70%" id="map"></div>
        <div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'top',splitter:true" style="height: 300px; padding: 0;">
            <div data-dojo-type="esri/widgets/geoenrichment/Infographic"
                id="infographic"
                data-dojo-props="onDataRequest:showProgress, onDataLoad:hideProgress"
                style="width: 100%; height: 100%;">
            </div>
        </div>
        <div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'center'">
            <div>This test demonstrates how individual Infographics can be contained within a layout widget and be resized along with the container. Please click on the map and select an Infographic in the drop-down:</div>
            <select data-dojo-type="dijit/form/Select" data-dojo-props="onChange: selectInfographic" id="typeSelect">
                <option value="AgePyramid">Age Pyramid</option>
                <option value="Tapestry">Tapestry</option>
                <option value="RelatedVariables">Race and Ethnicity</option>
                <option value="OneVar">Household Size</option>
            </select>
            <select data-dojo-type="dijit/form/Select" data-dojo-props="onChange: selectInfographic" id="expandedSelect">
                <option value="true">Expanded</option>
                <option value="false">Collapsed</option>
            </select>
        </div>
    </div>
    <div data-dojo-type="dijit/ProgressBar" data-dojo-props="indeterminate:true" class="ProgressBar" id="progressBar"></div>
</body>
</html>
