<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>onPan</title>

    <link rel="stylesheet" type="text/css" href="../../../../dojo/dijit/themes/tundra/tundra.css">
    <script>
        dojoConfig = {
            isDebug: true
        };
    </script>
    <script type="text/javascript" src="../../../../../index.jsp">
    </script>

    <script type="text/javascript">
      dojo.require("esri.map");
      dojo.require("doh.runner");

      var map;

      function init() {
        map = new esri.Map("mapDiv");
        dojo.connect(map, "onLoad", runTests);
        map.addLayer(new esri.layers.ArcGISDynamicMapServiceLayer("http://servery/ArcGIS/rest/services/Portland/PortlandMap/MapServer"));
      }
      
      function runTests() {
        doh.registerGroup("map.agsdynamic.onPan", [
          //Map.pan
          {
            name: "panUpperLeft",
            timeout: 5000,
            runTest: function(t) {
              var onPanHandler, onPanEndHandler, call = 0;
              var d = new doh.Deferred();

              function assert(extent, delta) {
                dojo.disconnect(onPanHandler);
                dojo.disconnect(onPanEndHandler);
                // t.assertEqual(11, call);
                d.callback(true);
              }
              
              function assertPans(extent, delta) {
                t.assertTrue(extent instanceof esri.geometry.Extent);
                t.assertTrue(delta instanceof esri.geometry.Point);
                call++;
              }

              setTimeout(function() {
                onPanHandler = dojo.connect(map, "onPan", assertPans);
                onPanEndHandler = dojo.connect(map, "onPanEnd", assert);
                map.panUpperLeft();
              }, 1000);
              return d;
            }
          },
          
          {
            name: "panLowerRight",
            timeout: 5000,
            runTest: function(t) {
              var onPanHandler, onPanEndHandler, call = 0;
              var d = new doh.Deferred();

              function assert(extent, delta) {
                dojo.disconnect(onPanHandler);
                dojo.disconnect(onPanEndHandler);
                // t.assertEqual(11, call);
                d.callback(true);
              }
              
              function assertPans(extent, delta) {
                t.assertTrue(extent instanceof esri.geometry.Extent);
                t.assertTrue(delta instanceof esri.geometry.Point);
                call++;
              }

              setTimeout(function() {
                onPanHandler = dojo.connect(map, "onPan", assertPans);
                onPanEndHandler = dojo.connect(map, "onPanEnd", assert);
                map.panLowerRight();
              }, 1000);
              return d;
            }
          },
          
          {
            name: "panUp",
            timeout: 5000,
            runTest: function(t) {
              var onPanHandler, onPanEndHandler, call = 0;
              var d = new doh.Deferred();

              function assert(extent, delta) {
                dojo.disconnect(onPanHandler);
                dojo.disconnect(onPanEndHandler);
                // t.assertEqual(11, call);
                d.callback(true);
              }
              
              function assertPans(extent, delta) {
                t.assertTrue(extent instanceof esri.geometry.Extent);
                t.assertTrue(delta instanceof esri.geometry.Point);
                call++;
              }

              setTimeout(function() {
                onPanHandler = dojo.connect(map, "onPan", assertPans);
                onPanEndHandler = dojo.connect(map, "onPanEnd", assert);
                map.panUp();
              }, 1000);
              return d;
            }
          },
          
          {
            name: "panDown",
            timeout: 5000,
            runTest: function(t) {
              var onPanHandler, onPanEndHandler, call = 0;
              var d = new doh.Deferred();

              function assert(extent, delta) {
                dojo.disconnect(onPanHandler);
                dojo.disconnect(onPanEndHandler);
                // t.assertEqual(11, call);
                d.callback(true);
              }
              
              function assertPans(extent, delta) {
                t.assertTrue(extent instanceof esri.geometry.Extent);
                t.assertTrue(delta instanceof esri.geometry.Point);
                call++;
              }

              setTimeout(function() {
                onPanHandler = dojo.connect(map, "onPan", assertPans);
                onPanEndHandler = dojo.connect(map, "onPanEnd", assert);
                map.panDown();
              }, 1000);
              return d;
            }
          },
          
          {
            name: "panUpperRight",
            timeout: 5000,
            runTest: function(t) {
              var onPanHandler, onPanEndHandler, call = 0;
              var d = new doh.Deferred();

              function assert(extent, delta) {
                dojo.disconnect(onPanHandler);
                dojo.disconnect(onPanEndHandler);
                // t.assertEqual(11, call);
                d.callback(true);
              }
              
              function assertPans(extent, delta) {
                t.assertTrue(extent instanceof esri.geometry.Extent);
                t.assertTrue(delta instanceof esri.geometry.Point);
                call++;
              }

              setTimeout(function() {
                onPanHandler = dojo.connect(map, "onPan", assertPans);
                onPanEndHandler = dojo.connect(map, "onPanEnd", assert);
                map.panUpperRight();
              }, 1000);
              return d;
            }
          },
          
          {
            name: "panLowerLeft",
            timeout: 5000,
            runTest: function(t) {
              var onPanHandler, onPanEndHandler, call = 0;
              var d = new doh.Deferred();

              function assert(extent, delta) {
                dojo.disconnect(onPanHandler);
                dojo.disconnect(onPanEndHandler);
                // t.assertEqual(11, call);
                d.callback(true);
              }
              
              function assertPans(extent, delta) {
                t.assertTrue(extent instanceof esri.geometry.Extent);
                t.assertTrue(delta instanceof esri.geometry.Point);
                call++;
              }

              setTimeout(function() {
                onPanHandler = dojo.connect(map, "onPan", assertPans);
                onPanEndHandler = dojo.connect(map, "onPanEnd", assert);
                map.panLowerLeft();
              }, 1000);
              return d;
            }
          },
          
          {
            name: "panRight",
            timeout: 5000,
            runTest: function(t) {
              var onPanHandler, onPanEndHandler, call = 0;
              var d = new doh.Deferred();

              function assert(extent, delta) {
                dojo.disconnect(onPanHandler);
                dojo.disconnect(onPanEndHandler);
                // t.assertEqual(11, call);
                d.callback(true);
              }
              
              function assertPans(extent, delta) {
                t.assertTrue(extent instanceof esri.geometry.Extent);
                t.assertTrue(delta instanceof esri.geometry.Point);
                call++;
              }

              setTimeout(function() {
                onPanHandler = dojo.connect(map, "onPan", assertPans);
                onPanEndHandler = dojo.connect(map, "onPanEnd", assert);
                map.panRight();
              }, 1000);
              return d;
            }
          },
          
          {
            name: "panLeft",
            timeout: 5000,
            runTest: function(t) {
              var onPanHandler, onPanEndHandler, call = 0;
              var d = new doh.Deferred();

              function assert(extent, delta) {
                dojo.disconnect(onPanHandler);
                dojo.disconnect(onPanEndHandler);
                // t.assertEqual(11, call);
                d.callback(true);
              }
              
              function assertPans(extent, delta) {
                t.assertTrue(extent instanceof esri.geometry.Extent);
                t.assertTrue(delta instanceof esri.geometry.Point);
                call++;
              }

              setTimeout(function() {
                onPanHandler = dojo.connect(map, "onPan", assertPans);
                onPanEndHandler = dojo.connect(map, "onPanEnd", assert);
                map.panLeft();
              }, 1000);
              return d;
            }
          },
          
          //Map.centerAt
          {
            name: "centerAt",
            timeout: 5000,
            runTest: function(t) {
              var onPanHandler, onPanEndHandler, call = 0;
              var d = new doh.Deferred();

              function assert(extent, delta) {
                dojo.disconnect(onPanHandler);
                dojo.disconnect(onPanEndHandler);
                // t.assertEqual(11, call);
                d.callback(true);
              }
              
              function assertPans(extent, delta) {
                t.assertTrue(extent instanceof esri.geometry.Extent);
                t.assertTrue(delta instanceof esri.geometry.Point);
                call++;
              }

              setTimeout(function() {
                onPanHandler = dojo.connect(map, "onPan", assertPans);
                onPanEndHandler = dojo.connect(map, "onPanEnd", assert);
                map.centerAt(new esri.geometry.Point({x:7656786.446536275,y:666311.142150807,spatialReference:{wkid:102726}}));
              }, 1000);
              return d;
            }
          },
          
          //Map.setExtent
          {
            name: "setExtentPan",
            timeout: 5000,
            runTest: function(t) {
              var onPanHandler, onPanEndHandler, call = 0;
              var d = new doh.Deferred();

              function assert(extent, delta) {
                dojo.disconnect(onPanHandler);
                dojo.disconnect(onPanEndHandler);
                // t.assertEqual(11, call);
                d.callback(true);
              }
              
              function assertPans(extent, delta) {
                t.assertTrue(extent instanceof esri.geometry.Extent);
                t.assertTrue(delta instanceof esri.geometry.Point);
                call++;
              }

              setTimeout(function() {
                onPanHandler = dojo.connect(map, "onPan", assertPans);
                onPanEndHandler = dojo.connect(map, "onPanEnd", assert);
                map.setExtent(new esri.geometry.Extent({xmin:7648872.088327432,ymin:672629.3272755139,xmax:7716975.4732505875,ymax:706681.0197370918,spatialReference:{wkid:102726}}));
              }, 1000);
              return d;
            }
          }
        ]);
        doh.run();
      }
      
      dojo.addOnLoad(init);
    </script>

  </head>
  <body class="tundra">
    <div id="mapDiv" style="width:1024px; height:512px; border:1px solid #000;"></div>
  </body>
</html>
