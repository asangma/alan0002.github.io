<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Query Features</title>
        <link rel="stylesheet" type="text/css" href="../../../../../dojo/dijit/themes/tundra/tundra.css">
        <script>
            dojoConfig = {
                isDebug: true
            };
        </script>
        <script type="text/javascript" src="../../../../../../index.jsp">
        </script>
        <script type="text/javascript">
            dojo.require("esri.geometry");
            dojo.require("esri.map");
            dojo.require("doh.runner");
            
                               
            function init(){
            
                var map = new esri.Map("mapDiv");
                dojo.connect(map, "onLoad", runTests);
                var layer = new esri.layers.ArcGISTiledMapServiceLayer("http://server.arcgisonline.com/ArcGIS/rest/services/ESRI_StreetMap_World_2D/MapServer");
                map.addLayer(layer);
                
                
            }
            
            function runTests(){
            
                doh.registerGroup("geometry.util.normalizepcs.pointTest", [{
                    name: "plus180",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPoint = new esri.geometry.Point({
                            "x": 196.1718749999484,
                            "y": -69.41124235696336,
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPoint = esri.geometry.geographicToWebMercator(gcsPoint);
                        esri.geometry.normalizeCentralMeridian([pcsPoint], null, function(normalizedGeo){
                            var normalizedPcsPoint = normalizedGeo[0];
                            var normalizedGcsPoint = esri.geometry.webMercatorToGeographic(normalizedPcsPoint);
                            t.assertEqual(Math.floor(normalizedGcsPoint.x), Math.floor(196.1718749999484 - 360));
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "minus180",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPoint = new esri.geometry.Point({
                            "x": -196.1718749999484,
                            "y": -69.41124235696336,
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPoint = esri.geometry.geographicToWebMercator(gcsPoint);
                        esri.geometry.normalizeCentralMeridian([pcsPoint], null, function(normalizedGeo){
                            var normalizedPcsPoint = normalizedGeo[0];
                            var normalizedGcsPoint = esri.geometry.webMercatorToGeographic(normalizedPcsPoint);
                            t.assertEqual(Math.floor(normalizedGcsPoint.x), Math.floor(-196.1718749999484 + 360));
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "plus540",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPoint = new esri.geometry.Point({
                            "x": 556.1718749999484,
                            "y": -69.41124235696336,
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPoint = esri.geometry.geographicToWebMercator(gcsPoint);
                        esri.geometry.normalizeCentralMeridian([pcsPoint], null, function(normalizedGeo){
                            var normalizedPcsPoint = normalizedGeo[0];
                            var normalizedGcsPoint = esri.geometry.webMercatorToGeographic(normalizedPcsPoint);
                            t.assertEqual(Math.floor(normalizedGcsPoint.x), Math.floor((556.1718749999484 - 360) - 360));
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "minus540",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPoint = new esri.geometry.Point({
                            "x": -556.1718749999484,
                            "y": -69.41124235696336,
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPoint = esri.geometry.geographicToWebMercator(gcsPoint);
                        esri.geometry.normalizeCentralMeridian([pcsPoint], null, function(normalizedGeo){
                            var normalizedPcsPoint = normalizedGeo[0];
                            var normalizedGcsPoint = esri.geometry.webMercatorToGeographic(normalizedPcsPoint);
                            t.assertEqual(Math.floor(normalizedGcsPoint.x), Math.floor((-556.1718749999484 + 360) + 360));
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "withinPlus180",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPoint = new esri.geometry.Point({
                            "x": 136.1718749999484,
                            "y": -69.41124235696336,
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPoint = esri.geometry.geographicToWebMercator(gcsPoint);
                        esri.geometry.normalizeCentralMeridian([pcsPoint], null, function(normalizedGeo){
                            var normalizedPcsPoint = normalizedGeo[0];
                            var normalizedGcsPoint = esri.geometry.webMercatorToGeographic(normalizedPcsPoint);
                            t.assertEqual(normalizedGcsPoint.x, gcsPoint.x);
                            
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "withinMinus180",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPoint = new esri.geometry.Point({
                            "x": -136.1718749999484,
                            "y": -69.41124235696336,
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        
                        var pcsPoint = esri.geometry.geographicToWebMercator(gcsPoint);
                        esri.geometry.normalizeCentralMeridian([pcsPoint], null, function(normalizedGeo){
                            var normalizedPcsPoint = normalizedGeo[0];
                            var normalizedGcsPoint = esri.geometry.webMercatorToGeographic(normalizedPcsPoint);
                            t.assertEqual(normalizedGcsPoint.x, gcsPoint.x);
                            
                            
                        });
                        
                        
                        
                    }
                    
                    
                }]);
                
                doh.run();
            }
            
            dojo.addOnLoad(init);
        </script>
    </head>
    <body class="tundra">
        <div id="mapDiv" style="width:900px; height:600px; border:1px solid #000;">
        </div>
    </body>
</html>
