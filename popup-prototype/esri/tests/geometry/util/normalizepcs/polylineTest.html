<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta name="generator" content="HTML Tidy, see www.w3.org">
        <meta http-equiv="Content-Type" content= "text/html; charset=utf-8">
        <title>Query Features</title>
        <link rel="stylesheet" type="text/css" href= "../../../../../dojo/dijit/themes/tundra/tundra.css">
        <script>
            dojoConfig = {
                isDebug: true
            };
        </script>
        <script type="text/javascript" src="../../../../../../index.jsp">
        </script>
        <script type="text/javascript">
            dojo.require("esri.geometry");
            dojo.require("esri.map");
            dojo.require("doh.runner");
            
            
            var geometryService;
            
            function init(){
            
                var map = new esri.Map("mapDiv");
                dojo.connect(map, "onLoad", runTests);
                var layer = new esri.layers.ArcGISTiledMapServiceLayer("http://server.arcgisonline.com/ArcGIS/rest/services/ESRI_StreetMap_World_2D/MapServer");
                map.addLayer(layer);
                
                
            }
            
            function runTests(){
            
                doh.registerGroup("geometry.util.normalizepcs.polylineTest", [{
                    name: "crossPlus180",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[156.09374999995893, -30.751277776250074], [216.56249999994304, -71.30079291636564], [304.45312499991996, -65.36683689225343], [311.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            t.assertEqual(2, normalizedGcsPolyline.paths.length);
                            t.assertEqual(-180, extent.xmin);
                            t.assertEqual(180, extent.xmax);
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "crossMinus180",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[-156.09374999995893, -30.751277776250074], [-216.56249999994304, -71.30079291636564], [-304.45312499991996, -65.36683689225343], [-311.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            t.assertEqual(2, normalizedGcsPolyline.paths.length);
                            t.assertEqual(-180, extent.xmin);
                            t.assertEqual(180, extent.xmax);
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "crossPlus540",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[516.09374999995893, -30.751277776250074], [576.56249999994304, -71.30079291636564], [664.45312499991996, -65.36683689225343], [671.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            t.assertEqual(2, normalizedGcsPolyline.paths.length);
                            t.assertEqual(-180, extent.xmin);
                            t.assertEqual(180, extent.xmax);
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "crossMinus540",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[-516.09374999995893, -30.751277776250074], [-576.56249999994304, -71.30079291636564], [-664.45312499991996, -65.36683689225343], [-671.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            t.assertEqual(2, normalizedGcsPolyline.paths.length);
                            t.assertEqual(-180, extent.xmin);
                            t.assertEqual(180, extent.xmax);
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "crossPlus180andPlus540",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[156.09374999995893, -30.751277776250074], [216.56249999994304, -71.30079291636564], [664.45312499991996, -65.36683689225343], [671.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            console.log(extent);
                            t.assertEqual(3, normalizedGcsPolyline.paths.length);
                            t.assertEqual(-180, extent.xmin);
                            t.assertEqual(180, extent.xmax);
                            
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "crossMinus180andMinus540",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[-156.09374999995893, -30.751277776250074], [-216.56249999994304, -71.30079291636564], [-664.45312499991996, -65.36683689225343], [-671.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            console.log(extent);
                            t.assertEqual(3, normalizedGcsPolyline.paths.length);
                            t.assertEqual(-180, extent.xmin);
                            t.assertEqual(180, extent.xmax);
                            
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "crossPlus540andPlus1260",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[516.09374999995893, -30.751277776250074], [576.56249999994304, -71.30079291636564], [1384.45312499991996, -65.36683689225343], [1391.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            console.log(extent.xmax);
                            t.assertEqual(4, normalizedGcsPolyline.paths.length);
                            t.assertEqual(-180, extent.xmin);
                            t.assertEqual(180, extent.xmax);//xmax = 900
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "crossMinus540andMinus1260",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[-516.09374999995893, -30.751277776250074], [-576.56249999994304, -71.30079291636564], [-1384.45312499991996, -65.36683689225343], [-1391.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            t.assertEqual(4, normalizedGcsPolyline.paths.length);
                            t.assertEqual(-180, extent.xmin);
                            t.assertEqual(180, extent.xmax);//xmax = 540
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "withinMinusPlus180",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[-156.09374999995893, -30.751277776250074], [-176.56249999994304, -71.30079291636564], [104.45312499991996, -65.36683689225343], [171.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            
                            t.assertEqual(1, normalizedGcsPolyline.paths.length);
                            t.assertEqual(-176.56249999994304, extent.xmin);
                            t.assertEqual(171.4843749999181, extent.xmax);
                            
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "withinPlus540ToPlus720",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[556.09374999995893, -30.751277776250074], [576.56249999994304, -71.30079291636564], [684.45312499991996, -65.36683689225343], [711.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            t.assertEqual(1, normalizedGcsPolyline.paths.length);
                            t.assertEqual(gcsPolyline.getExtent().xmin - 720, extent.xmin);
                            t.assertEqual(gcsPolyline.getExtent().xmax - 720, extent.xmax);
                            
                            
                        });
                        
                        
                        
                    }
                    
                    
                }, {
                    name: "withinMinus540ToMinus720",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var gcsPolyline = new esri.geometry.Polyline({
                            "paths": [[[-556.09374999995893, -30.751277776250074], [-576.56249999994304, -71.30079291636564], [-684.45312499991996, -65.36683689225343], [-711.4843749999181, -52.482780222068]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        
                        esri.geometry.normalizeCentralMeridian([pcsPolyline], geometryService, function(normalizedGeo){
                            var normalizedPcsPolyline = normalizedGeo[0];
                            var normalizedGcsPolyline = esri.geometry.webMercatorToGeographic(normalizedPcsPolyline);
                            var extent = normalizedGcsPolyline.getExtent();
                            
                            t.assertEqual(1, normalizedGcsPolyline.paths.length);
                            t.assertEqual(gcsPolyline.getExtent().xmin + 720, extent.xmin);
                            t.assertEqual(gcsPolyline.getExtent().xmax + 720, extent.xmax);
                            
                            
                        });
                        
                        
                        
                    }
                    
                    
                }], function()//setUp()
                {
                    esriConfig.request.proxyUrl = "../../../proxy.jsp";
                    esriConfig.request.forceProxy = false;
                    geometryService = new esri.tasks.GeometryService("http://servery/ArcGIS/rest/services/Geometry/GeometryServer");
                    
                }, function()//tearDown
                {
                    geometryService = null;
                    
                });
                
                
                doh.run();
            }
            
            dojo.addOnLoad(init);
        </script>
    </head>
    <body class="tundra">
        <div id="mapDiv" style="width:900px; height:600px; border:1px solid #000;">
        </div>
    </body>
</html>
