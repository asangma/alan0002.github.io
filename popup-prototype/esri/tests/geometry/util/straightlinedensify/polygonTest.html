<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta name="generator" content="HTML Tidy, see www.w3.org">
        <meta http-equiv="Content-Type" content= "text/html; charset=utf-8">
        <title>Query Features</title>
        <link rel="stylesheet" type="text/css" href= "../../../../../dojo/dijit/themes/tundra/tundra.css">
        <script>
            dojoConfig = {
                isDebug: true
            };
        </script>
        <script type="text/javascript" src="../../../../../../index.jsp">
        </script>
        <script type="text/javascript">
            dojo.require("esri.geometry");
            dojo.require("esri.map");
            dojo.require("doh.runner");
            
            
            var geometryService;
            
            function init(){
            
                var map = new esri.Map("mapDiv");
                dojo.connect(map, "onLoad", runTests);
                var layer = new esri.layers.ArcGISTiledMapServiceLayer("http://server.arcgisonline.com/ArcGIS/rest/services/ESRI_StreetMap_World_2D/MapServer");
                map.addLayer(layer);
                
                
            }
            
            function runTests(){
            
            
                doh.registerGroup("geometry.util.straightlinedensify.polygonTest", [{
                    name: "maxseglen1000000 ",
                    timeout: 3000,
                    runTest: function(t){
                        var densifiedFromGeometryServerGeometryJson = {
                            "geometryType": "esriGeometryPolygon",
                            
                            "geometries": [{
                                "rings": [[[-5910369.2143007, -9286883.14722518], [-5269315.82721574, -8574152.25790653], [-4628262.44013079, -7861421.36858788], [-3987209.05304584, -7148690.47926923], [-3346155.66596088, -6435959.58995058], [-2705102.27887593, -5723228.70063193], [-2064048.89179098, -5010497.81131328], [-1422995.50470603, -4297766.92199463], [-781942.117621073, -3585036.03267598], [-140888.730536119, -2872305.14335733], [500164.656548834, -2159574.25403869], [1141218.04363379, -1446843.36472004], [1782271.43071874, -734112.475401388], [2423324.81780369, -21381.5860827379], [3064378.20488864, 691349.303235909], [3705431.5919736, 1404080.19255456], [4346484.97905855, 2116811.08187321], [4987538.36614351, 2829541.97119186], [5628591.75322846, 3542272.86051051], [5537101.04673223, 4530191.66333576], [5445610.34023599, 5518110.46616101], [5354119.63373976, 6506029.26898626], [5262628.92724352, 7493948.07181151], [5171138.22074729, 8481866.87463676], [4838049.43188924, 9253750.54449681], [4504960.6430312, 10025634.2143569], [4171871.85417316, 10797517.8842169], [3838783.06531511, 11569401.554077], [3432568.38699779, 10700389.6915227], [3026353.70868046, 9831377.82896845], [2620139.03036314, 8962365.9664142], [2213924.35204581, 8093354.10385994], [1807709.67372849, 7224342.24130569], [1401494.99541116, 6355330.37875143], [995280.317093835, 5486318.51619718], [589065.63877651, 4617306.65364292], [182850.960459184, 3748294.79108866], [-223363.717858141, 2879282.92853441], [-629578.396175467, 2010271.06598015], [-1035793.07449279, 1141259.2034259], [-1442007.75281012, 272247.34087164], [-1848222.43112744, -596764.521682614], [-2254437.10944477, -1465776.38423687], [-2660651.78776209, -2334788.24679113], [-3066866.46607942, -3203800.10934538], [-3473081.14439674, -4072811.97189964], [-3879295.82271407, -4941823.8344539], [-4285510.5010314, -5810835.69700815], [-4691725.17934872, -6679847.55956241], [-5097939.85766605, -7548859.42211666], [-5504154.53598337, -8417871.28467092], [-5910369.2143007, -9286883.14722518]]]
                            }]
                        
                        };
                        
                        var rings = densifiedFromGeometryServerGeometryJson.geometries[0].rings;
                        
                        var gcsPolygon = new esri.geometry.Polygon({
                            "rings": [[[-53.09374999995893, -63.751277776250074], [50.56249999994304, 30.30079291636564], [46.45312499991996, 60.36683689225343], [34.4843749999181, 71.482780222068], [-53.09374999995893, -63.751277776250074]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        var pcsPolygon = esri.geometry.geographicToWebMercator(gcsPolygon);
                        console.log(dojo.toJson(pcsPolygon.toJson()));
                        
                        var clientDensifiedGeometry = esri.geometry._straightLineDensify(pcsPolygon, 1000000);
                        var clientDensifiedGeometryJson = clientDensifiedGeometry.toJson();
                        var densifiedFromGeometryServerGeometry = new esri.geometry.Polygon({
                            "rings": rings,
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        
                        var densifiedFromGeometryServerGeometryExtent = densifiedFromGeometryServerGeometry.getExtent();
                        console.log(densifiedFromGeometryServerGeometry.rings[0].length);
                        
                        t.assertEqual(clientDensifiedGeometry.rings[0].length,densifiedFromGeometryServerGeometry.rings[0].length);
                    
                    }
                    
                    
                }, {
                    name: "maxseglen50000 ",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var expectedLengthDensifiedFromGeometryServerGeometryPoints = 976;
                        
                        var gcsPolygon = new esri.geometry.Polygon({
                            "rings": [[[-53.09374999995893, -63.751277776250074], [50.56249999994304, 30.30079291636564], [46.45312499991996, 60.36683689225343], [34.4843749999181, 71.482780222068], [-53.09374999995893, -63.751277776250074]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        var pcsPolygon = esri.geometry.geographicToWebMercator(gcsPolygon);
                        
                        var clientDensifiedGeometry = esri.geometry._straightLineDensify(pcsPolygon, 50000);
                        console.log(clientDensifiedGeometry.rings[0].length);
                        
                        t.assertEqual(clientDensifiedGeometry.rings[0].length,expectedLengthDensifiedFromGeometryServerGeometryPoints);
                    
                    }
                    
                    
                }, {
                    name: "maxseglen10000 ",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var expectedLengthDensifiedFromGeometryServerGeometryPoints = 4864;
                        
                        var gcsPolygon = new esri.geometry.Polygon({
                            "rings": [[[-53.09374999995893, -63.751277776250074], [50.56249999994304, 30.30079291636564], [46.45312499991996, 60.36683689225343], [34.4843749999181, 71.482780222068], [-53.09374999995893, -63.751277776250074]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        });
                        var pcsPolygon = esri.geometry.geographicToWebMercator(gcsPolygon);
                        
                        var clientDensifiedGeometry = esri.geometry._straightLineDensify(pcsPolygon, 10000);
                        console.log(clientDensifiedGeometry.rings[0].length);
                        
                        t.assertEqual(clientDensifiedGeometry.rings[0].length,expectedLengthDensifiedFromGeometryServerGeometryPoints);
                    
                    }
                    
                    
                }, ], function()//setUp()
                {
                    esriConfig.request.proxyUrl = "../../../proxy.jsp";
                    esriConfig.request.forceProxy = false;
                    geometryService = new esri.tasks.GeometryService("http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer");
                    
                }, function()//tearDown
                {
                    geometryService = null;
                    
                });
                
                
                doh.run();
            }
            
            dojo.addOnLoad(init);
        </script>
    </head>
    <body class="tundra">
        <div id="mapDiv" style="width:900px; height:600px; border:1px solid #000;">
        </div>
    </body>
</html>
