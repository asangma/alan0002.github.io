<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta name="generator" content="HTML Tidy, see www.w3.org">
        <meta http-equiv="Content-Type" content= "text/html; charset=utf-8">
        <title>Query Features</title>
        <link rel="stylesheet" type="text/css" href= "../../../../dojo/dijit/themes/tundra/tundra.css">
        <script>
            dojoConfig = {
                isDebug: true
            };
        </script>
        <script type="text/javascript" src="../../../../../index.jsp">
        </script>
        <script type="text/javascript">
            dojo.require("esri.geometry");
            dojo.require("esri.map");
            dojo.require("doh.runner");
            
            
            var geometryService;
            
            function init(){
            
                var map = new esri.Map("mapDiv");
                dojo.connect(map, "onLoad", runTests);
                var layer = new esri.layers.ArcGISDynamicMapServiceLayer("http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Specialty/ESRI_StatesCitiesRivers_USA/MapServer");
                map.addLayer(layer);
                
                
            }
            
            function runTests(){
            
            
                doh.registerGroup("geometry.namespace.geographicToWebMercatorTest", [{
                    name: "testExtent",
                    timeout: 3000,
                    runTest: function(t){
                        var extentJson = {
                            "xmin": -124.23106691698482,
                            "ymin": 32.3839211372695,
                            "xmax": -116.22498215322904,
                            "ymax": 38.94891064354925,
                            "spatialReference": {
                                "wkid": 4326
                            }
                        };
                        
                        var gcsExtent = esri.geometry.fromJson(extentJson);
                        var pcsExtent = esri.geometry.geographicToWebMercator(gcsExtent);
                        var outSR = new esri.SpatialReference({
                            wkid: 102100
                        });
                        
                        var handler = dojo.connect(geometryService, "onProjectComplete", projectedResult);
                        geometryService.project([gcsExtent], outSR);
                        
                        
                        function projectedResult(results){
                            dojo.disconnect(handler);
                            console.log(dojo.toJson(results[0].toJson()));
                        }
                        console.log(dojo.toJson(pcsExtent.toJson()));
                        
                        
                    }
                }, {
                    name: "testMultipoint",
                    timeout: 3000,
                    runTest: function(t){
                    
                        var multipointJson = {
                            "points": [[-123.11021505005901, 37.66793708134833], [-117.66607741070507, 37.98818047189856], [-117.50595571542996, 33.66489469947042], [-122.14948487840832, 32.22379944199439], [-121.34887640203274, 31.423190965618808]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        };
                        
                        var gcsMultipoint = esri.geometry.fromJson(multipointJson);
                        
                        var pcsMultipoint = esri.geometry.geographicToWebMercator(gcsMultipoint);
                        var outSR = new esri.SpatialReference({
                            wkid: 102100
                        });
                        
                        var handler = dojo.connect(geometryService, "onProjectComplete", projectedResult);
                        geometryService.project([gcsMultipoint], outSR);
                        
                        
                        function projectedResult(results){
                            dojo.disconnect(handler);
                            console.log(dojo.toJson(results[0].toJson()));
                        }
                        console.log(dojo.toJson(pcsMultipoint.toJson()));
                        
                        
                        
                    }
                }, {
                    name: "testPoint",
                    timeout: 3000,
                    runTest: function(t){
                        var pointJson = {
                            "x": -117.82619910598018,
                            "y": 35.906598433322046,
                            "spatialReference": {
                                "wkid": 4326
                            }
                        }
                        
                        var gcsPoint = esri.geometry.fromJson(pointJson);
                        var pcsPoint = esri.geometry.geographicToWebMercator(gcsPoint);
                        var outSR = new esri.SpatialReference({
                            wkid: 102100
                        });
                        
                        var handler = dojo.connect(geometryService, "onProjectComplete", projectedResult);
                        geometryService.project([gcsPoint], outSR);
                        
                        
                        function projectedResult(results){
                            dojo.disconnect(handler);
                            console.log(dojo.toJson(results[0].toJson()));
                        }
                        console.log(dojo.toJson(pcsPoint.toJson()));
                        
                        
                    }
                }, {
                    name: "testPolyline",
                    timeout: 3000,
                    runTest: function(t){
                        var polylineJson = {
                            "paths": [[[-121.50899809730785, 40.06976251047506], [-115.58449537212857, 39.58939742464971], [-114.78388689575299, 32.22379944199439], [-120.54826792565716, 30.94282587979346]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        };
                        
                        var gcsPolyline = esri.geometry.fromJson(polylineJson);
                        var pcsPolyline = esri.geometry.geographicToWebMercator(gcsPolyline);
                        var outSR = new esri.SpatialReference({
                            wkid: 102100
                        });
                        
                        var handler = dojo.connect(geometryService, "onProjectComplete", projectedResult);
                        geometryService.project([gcsPolyline], outSR);
                        
                        
                        function projectedResult(results){
                            dojo.disconnect(handler);
                            console.log(dojo.toJson(results[0].toJson()));
                        }
                        console.log(dojo.toJson(pcsPolyline.toJson()));
                        
                    }
                }, {
                    name: "testPolygon",
                    timeout: 3000,
                    runTest: function(t){
                        var polygonJson = {
                            "rings": [[[-122.95009335478389, 39.429275729374595], [-108.21889738947323, 36.06672012859717], [-122.14948487840832, 25.658809935714636], [-123.43045844060924, 38.628667252999016], [-122.95009335478389, 39.429275729374595]]],
                            "spatialReference": {
                                "wkid": 4326
                            }
                        
                        };
                        
                        var gcsPolygon = esri.geometry.fromJson(polygonJson);
                        var pcsPolygon = esri.geometry.geographicToWebMercator(gcsPolygon);
                        var outSR = new esri.SpatialReference({
                            wkid: 102100
                        });
                        
                        var handler = dojo.connect(geometryService, "onProjectComplete", projectedResult);
                        geometryService.project([gcsPolygon], outSR);
                        
                        
                        function projectedResult(results){
                            dojo.disconnect(handler);
                            console.log(dojo.toJson(results[0].toJson()));
                        }
                        console.log(dojo.toJson(pcsPolygon.toJson()));
                    }
                }], function()//setUp()
                {
                    esriConfig.request.proxyUrl = "../../../proxy.jsp";
                    esriConfig.request.forceProxy = false;
                    geometryService = new esri.tasks.GeometryService("http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer");
                    
                }, function()//tearDown
                {
                    geometryService = null;
                    
                });
                
                doh.run();
            }
            
            dojo.addOnLoad(init);
        </script>
    </head>
    <body class="tundra">
        <div id="mapDiv" style="width:900px; height:600px; border:1px solid #000;">
        </div>
    </body>
</html>
